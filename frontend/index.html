<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Test Case Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: { 50: '#f0f4ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc', 400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca', 800: '#3730a3', 900: '#312e81' },
                        success: { 50: '#f0fdf4', 100: '#dcfce7', 500: '#22c55e', 600: '#16a34a' },
                        warning: { 50: '#fffbeb', 100: '#fef3c7', 500: '#f59e0b', 600: '#d97706' },
                        danger: { 50: '#fef2f2', 100: '#fee2e2', 500: '#ef4444', 600: '#dc2626' }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'slide-down': 'slideDown 0.3s ease-out',
                        'pulse': 'pulse 1.5s infinite',
                        'spin-slow': 'spin 2s linear infinite',
                        'expand': 'expand 0.3s ease-out',
                        'bounce-soft': 'bounceSoft 0.5s ease-out'
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        slideDown: { '0%': { opacity: '0', transform: 'translateY(-10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        expand: { '0%': { opacity: '0', maxHeight: '0' }, '100%': { opacity: '1', maxHeight: '500px' } },
                        bounceSoft: { '0%': { transform: 'scale(0.95)' }, '50%': { transform: 'scale(1.02)' }, '100%': { transform: 'scale(1)' } }
                    }
                }
            }
        }
    </script>
    <style>
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #a1a1a1; }
        .dark ::-webkit-scrollbar-track { background: #374151; }
        .dark ::-webkit-scrollbar-thumb { background: #6b7280; }
        .dark ::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
        
        * { transition: background-color 0.2s, border-color 0.2s, color 0.2s, box-shadow 0.2s; }
        
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        .skeleton { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        .dark .skeleton { background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%); background-size: 200% 100%; }
        
        .toast-enter { transform: translateX(100%); opacity: 0; }
        .toast-enter-active { transform: translateX(0); opacity: 1; transition: all 0.3s ease-out; }
        .toast-exit { transform: translateX(0); opacity: 1; }
        .toast-exit-active { transform: translateX(100%); opacity: 0; transition: all 0.3s ease-in; }
        
        .page { display: none; }
        .page.active { display: block; }
        
        .nav-item { position: relative; }
        .nav-item.active::after { content: ''; position: absolute; bottom: -2px; left: 0; right: 0; height: 2px; background: currentColor; }
        
        .card-select { cursor: pointer; }
        .card-select.selected { ring: 2px; ring-color: #6366f1; }
        
        .progress-ring { transition: stroke-dashoffset 0.5s ease; }
        
        .filter-btn.active { background: #6366f1; color: white; border-color: #6366f1; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 min-h-screen">
    <div id="toastContainer" class="fixed top-4 right-4 z-50 flex flex-col gap-2"></div>

    <!-- Navigation Header -->
    <header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-40">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-primary-500 to-primary-700 rounded-xl flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                    </svg>
                </div>
                <div>
                    <h1 class="text-lg font-bold text-gray-800 dark:text-white">AI Test Case Generator</h1>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Automated QA Suite</p>
                </div>
            </div>
            
            <nav class="flex items-center gap-1">
                <button onclick="showPage('home')" class="nav-item px-4 py-2 text-sm font-medium rounded-lg transition-colors" data-page="home">Home</button>
                <button onclick="showPage('requirements')" class="nav-item px-4 py-2 text-sm font-medium rounded-lg transition-colors" data-page="requirements">Requirements</button>
                <button onclick="showPage('artifacts')" class="nav-item px-4 py-2 text-sm font-medium rounded-lg transition-colors" data-page="artifacts">Artifacts</button>
                <button onclick="showPage('rtm')" class="nav-item px-4 py-2 text-sm font-medium rounded-lg transition-colors" data-page="rtm">RTM</button>
            </nav>
            
            <div class="flex items-center gap-2">
                <button id="themeToggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                    <svg id="sunIcon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                    </svg>
                    <svg id="moonIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6 max-w-6xl">
        
        <!-- HOME PAGE -->
        <div id="page-home" class="page active">
            <div class="text-center py-16">
                <div class="w-24 h-24 bg-gradient-to-br from-primary-400 to-primary-600 rounded-2xl mx-auto mb-6 flex items-center justify-center shadow-lg">
                    <svg class="w-14 h-14 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                    </svg>
                </div>
                <h1 class="text-4xl font-bold text-gray-800 dark:text-white mb-4">AI-Powered Test Case Generator</h1>
                <p class="text-lg text-gray-600 dark:text-gray-400 mb-8 max-w-2xl mx-auto">
                    Transform requirements into comprehensive, traceable test cases with AI-driven analysis, normalization, and test strategy generation.
                </p>
                <div class="flex justify-center gap-4">
                    <button onclick="showPage('requirements')" class="px-8 py-3 bg-gradient-to-r from-primary-600 to-primary-700 text-white rounded-xl hover:from-primary-700 hover:to-primary-800 transition-all font-medium shadow-lg hover:shadow-xl flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                        </svg>
                        Start New Project
                    </button>
                </div>
            </div>
            
            <!-- Features Grid -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-12">
                <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700">
                    <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center mb-4">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-2">Smart Requirements</h3>
                    <p class="text-gray-600 dark:text-gray-400 text-sm">AI parses and normalizes requirements into structured format with ambiguity detection.</p>
                </div>
                
                <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700">
                    <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-xl flex items-center justify-center mb-4">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-2">Comprehensive Artifacts</h3>
                    <p class="text-gray-600 dark:text-gray-400 text-sm">Generate detailed test plans, strategies, scenarios, and test cases automatically.</p>
                </div>
                
                <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700">
                    <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-xl flex items-center justify-center mb-4">
                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                        </svg>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-2">Full Traceability</h3>
                    <p class="text-gray-600 dark:text-gray-400 text-sm">Complete RTM with linked requirements, test cases, and coverage analysis.</p>
                </div>
            </div>
        </div>

        <!-- REQUIREMENTS PAGE -->
        <div id="page-requirements" class="page">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Requirements Gathering</h2>
                    <p class="text-gray-500 dark:text-gray-400">Enter requirements, review AI analysis, and select for test generation</p>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="clearRequirements()" class="px-4 py-2 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-sm">
                        Clear All
                    </button>
                    <button onclick="processRequirements()" class="px-6 py-2 bg-gradient-to-r from-primary-600 to-primary-700 text-white rounded-xl hover:from-primary-700 hover:to-primary-800 transition-all font-medium shadow-md flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                        Process Requirements
                    </button>
                </div>
            </div>
            
            <!-- Input Section -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">Raw Requirements Input</h3>
                    <div class="relative">
                        <button onclick="toggleTemplateDropdown()" class="text-sm text-primary-600 dark:text-primary-400 hover:text-primary-700 flex items-center gap-1 px-3 py-1 rounded-lg hover:bg-primary-50 dark:hover:bg-primary-900/20">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                            </svg>
                            Load Template
                        </button>
                        <div id="templateDropdown" class="hidden absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 z-10">
                            <div class="p-2">
                                <button onclick="loadTemplate('flash_sale')" class="w-full text-left px-4 py-2.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-sm flex items-center gap-2">
                                    <span>‚ö°</span> Flash Sale E-Commerce
                                </button>
                                <button onclick="loadTemplate('parking')" class="w-full text-left px-4 py-2.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-sm flex items-center gap-2">
                                    <span>üÖøÔ∏è</span> Smart Parking System
                                </button>
                                <button onclick="loadTemplate('food_delivery')" class="w-full text-left px-4 py-2.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-sm flex items-center gap-2">
                                    <span>üçî</span> Food Delivery Platform
                                </button>
                                <button onclick="loadTemplate('wallet')" class="w-full text-left px-4 py-2.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-sm flex items-center gap-2">
                                    <span>üí∞</span> Digital Wallet
                                </button>
                                <button onclick="loadTemplate('telemedicine')" class="w-full text-left px-4 py-2.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-sm flex items-center gap-2">
                                    <span>ü©∫</span> Telemedicine Platform
                                </button>
                                <button onclick="loadTemplate('comprehensive_test')" class="w-full text-left px-4 py-2.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-sm flex items-center gap-2 border-t border-gray-200 dark:border-gray-600 mt-2 pt-2">
                                    <span>üß™</span> Comprehensive Test Suite
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <textarea id="requirementsInput" 
                    class="w-full h-48 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-100 focus:outline-none focus:border-primary-500 resize-y text-sm"
                    placeholder="Enter your software requirements here...&#10;&#10;Guidelines:&#10;‚Ä¢ Use clear, specific language&#10;‚Ä¢ Include conditions and expected outcomes&#10;‚Ä¢ Specify actors and actions&#10;‚Ä¢ Example: User shall login with valid credentials within 5 seconds"></textarea>
                <div class="flex justify-between items-center mt-3">
                    <span class="text-xs text-gray-500 dark:text-gray-400"><span id="charCount">0</span> characters</span>
                </div>
            </div>
            
            <!-- Loading State -->
            <div id="requirementsLoading" class="hidden">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 p-8">
                    <div class="flex items-center justify-center">
                        <div class="text-center">
                            <svg class="animate-spin-slow w-14 h-14 text-primary-500 mx-auto mb-4" fill="none" viewBox="0 0 50 50">
                                <circle class="opacity-25" cx="25" cy="25" r="20" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M25 5A20 20 0 0125 45z"></path>
                            </svg>
                            <p class="text-lg font-medium text-gray-700 dark:text-gray-200 mb-2">Analyzing Requirements...</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Parsing, normalizing, and detecting ambiguities</p>
                            <div class="w-64 h-2 bg-gray-200 dark:bg-gray-600 rounded-full mt-4 overflow-hidden mx-auto">
                                <div id="reqProgressBar" class="h-full bg-gradient-to-r from-primary-500 to-primary-600 rounded-full animate-pulse" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- AI Analysis Results -->
            <div id="aiAnalysisSection" class="hidden">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">AI Analysis Results</h3>
                    <div class="flex items-center gap-3">
                        <!-- Filters -->
                        <select id="priorityFilter" onchange="filterRequirements()" class="px-3 py-1.5 border border-gray-200 dark:border-gray-600 rounded-lg text-sm bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300">
                            <option value="all">All Priorities</option>
                            <option value="High">High</option>
                            <option value="Medium">Medium</option>
                            <option value="Low">Low</option>
                        </select>
                        <select id="confidenceFilter" onchange="filterRequirements()" class="px-3 py-1.5 border border-gray-200 dark:border-gray-600 rounded-lg text-sm bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300">
                            <option value="all">All Confidence</option>
                            <option value="high">High (‚â•80%)</option>
                            <option value="medium">Medium (60-79%)</option>
                            <option value="low">Low (&lt;60%)</option>
                        </select>
                        <button id="selectAllBtn" onclick="toggleSelectAll()" class="text-sm text-primary-600 dark:text-primary-400 hover:text-primary-700">Deselect All</button>
                        <button onclick="generateFromSelected()" class="px-6 py-2 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-xl hover:from-green-700 hover:to-green-800 transition-all font-medium shadow-md flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Generate Artifacts
                        </button>
                    </div>
                </div>
                
                <div id="requirementsList" class="space-y-4 mb-6"></div>
            </div>
        </div>

        <!-- ARTIFACTS PAGE -->
        <div id="page-artifacts" class="page">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Test Artifacts</h2>
                    <p class="text-gray-500 dark:text-gray-400">Comprehensive test documentation and test cases</p>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="exportArtifacts()" class="px-4 py-2 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2 text-sm">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                        </svg>
                        Export All
                    </button>
                </div>
            </div>
            
            <!-- Tabbed Artifacts -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden">
                <div class="flex overflow-x-auto border-b border-gray-200 dark:border-gray-700">
                    <button onclick="switchArtifactTab('testcases')" class="artifact-tab px-6 py-3 text-sm font-medium border-b-2 border-primary-500 text-primary-600" data-tab="testcases">Test Cases</button>
                    <button onclick="switchArtifactTab('scenarios')" class="artifact-tab px-6 py-3 text-sm font-medium border-b-2 border-transparent text-gray-600 dark:text-gray-400" data-tab="scenarios">Test Scenarios</button>
                    <button onclick="switchArtifactTab('strategy')" class="artifact-tab px-6 py-3 text-sm font-medium border-b-2 border-transparent text-gray-600 dark:text-gray-400" data-tab="strategy">Test Strategy</button>
                    <button onclick="switchArtifactTab('testplan')" class="artifact-tab px-6 py-3 text-sm font-medium border-b-2 border-transparent text-gray-600 dark:text-gray-400" data-tab="testplan">Test Plan</button>
                </div>
                
                <div class="p-6">
                    <!-- Test Cases Tab -->
                    <div id="artifact-testcases" class="artifact-content">
                        <!-- Filters inside Test Cases tab -->
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4 mb-4">
                            <div class="flex flex-wrap gap-4">
                                <!-- Priority Filters -->
                                <div class="flex items-center gap-2">
                                    <span class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Priority:</span>
                                    <button onclick="filterTestCases('all')" class="filter-btn px-3 py-1.5 rounded-lg text-xs transition-colors bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-500" data-filter="all">All</button>
                                    <button onclick="filterTestCases('P0')" class="filter-btn px-3 py-1.5 rounded-lg text-xs transition-colors bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-500" data-filter="P0">P0</button>
                                    <button onclick="filterTestCases('P1')" class="filter-btn px-3 py-1.5 rounded-lg text-xs transition-colors bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-500" data-filter="P1">P1</button>
                                    <button onclick="filterTestCases('P2')" class="filter-btn px-3 py-1.5 rounded-lg text-xs transition-colors bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-500" data-filter="P2">P2</button>
                                </div>
                                <!-- Flow Filters -->
                                <div class="flex items-center gap-2">
                                    <span class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Flow:</span>
                                    <button onclick="filterTestCases('Positive')" class="filter-btn px-3 py-1.5 rounded-lg text-xs transition-colors bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-500" data-filter="Positive">Positive</button>
                                    <button onclick="filterTestCases('Negative')" class="filter-btn px-3 py-1.5 rounded-lg text-xs transition-colors bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-500" data-filter="Negative">Negative</button>
                                    <button onclick="filterTestCases('Boundary')" class="filter-btn px-3 py-1.5 rounded-lg text-xs transition-colors bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-500" data-filter="Boundary">Boundary</button>
                                    <button onclick="filterTestCases('Edge')" class="filter-btn px-3 py-1.5 rounded-lg text-xs transition-colors bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-500" data-filter="Edge">Edge</button>
                                </div>
                                <!-- Type Filters -->
                                <div class="flex items-center gap-2">
                                    <span class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Type:</span>
                                    <button onclick="filterTestCases('Manual')" class="filter-btn px-3 py-1.5 rounded-lg text-xs transition-colors bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-500" data-filter="Manual">Manual</button>
                                    <button onclick="filterTestCases('Automation')" class="filter-btn px-3 py-1.5 rounded-lg text-xs transition-colors bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-500" data-filter="Automation">Automation</button>
                                </div>
                            </div>
                        </div>
                        <div id="testCasesList" class="space-y-3"></div>
                    </div>
                    
                    <!-- Test Scenarios Tab -->
                    <div id="artifact-scenarios" class="artifact-content hidden">
                        <div id="testScenariosContent" class="space-y-4"></div>
                    </div>
                    
                    <!-- Test Strategy Tab -->
                    <div id="artifact-strategy" class="artifact-content hidden">
                        <div id="testStrategyContent" class="prose dark:prose-invert max-w-none"></div>
                    </div>
                    
                    <!-- Test Plan Tab -->
                    <div id="artifact-testplan" class="artifact-content hidden">
                        <div id="testPlanContent" class="prose dark:prose-invert max-w-none"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RTM PAGE -->
        <div id="page-rtm" class="page">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Requirements Traceability Matrix</h2>
                    <p class="text-gray-500 dark:text-gray-400">Complete traceability between requirements and test cases</p>
                </div>
            </div>
            
            <!-- RTM Stats -->
            <div class="grid grid-cols-4 gap-4 mb-6">
                <div class="bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-100 dark:border-gray-700 cursor-pointer hover:shadow-md transition-all" onclick="filterTestCases('rtm-requirements')">
                    <div class="text-2xl font-bold text-primary-600" id="rtmReqCount">0</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">Requirements</div>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-100 dark:border-gray-700 cursor-pointer hover:shadow-md transition-all" onclick="filterTestCases('rtm-testcases')">
                    <div class="text-2xl font-bold text-green-600" id="rtmTcCount">0</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">Test Cases</div>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-100 dark:border-gray-700 cursor-pointer hover:shadow-md transition-all" onclick="filterTestCases('rtm-coverage')">
                    <div class="text-2xl font-bold text-emerald-600" id="rtmCoverage">0%</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">Coverage</div>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-100 dark:border-gray-700 cursor-pointer hover:shadow-md transition-all" onclick="filterTestCases('rtm-ambiguous')">
                    <div class="text-2xl font-bold text-amber-500" id="rtmAmbig">0</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">Ambiguous</div>
                </div>
            </div>
            
            <!-- Charts Section -->
            <div class="grid grid-cols-2 gap-6 mb-6">
                <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 border border-gray-100 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Test Type Distribution</h3>
                    <div id="rtmTypeChart" class="space-y-3"></div>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 border border-gray-100 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Priority Distribution</h3>
                    <div id="rtmPriorityChart" class="space-y-3"></div>
                </div>
            </div>
            
            <!-- RTM Table -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden mb-6">
                <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">Traceability Matrix</h3>
                    <div class="flex items-center gap-4">
                        <span class="text-xs text-gray-500 dark:text-gray-400">
                            <span class="inline-block w-3 h-3 rounded-sm bg-green-500 mr-1"></span>Positive
                            <span class="inline-block w-3 h-3 rounded-sm bg-red-500 ml-2 mr-1"></span>Negative
                            <span class="inline-block w-3 h-3 rounded-sm bg-yellow-500 ml-2 mr-1"></span>Edge
                            <span class="inline-block w-3 h-3 rounded-sm bg-blue-500 ml-2 mr-1"></span>Boundary
                        </span>
                        <button onclick="toggleRTMView()" id="rtmFlipBtn" class="px-3 py-1.5 bg-primary-100 dark:bg-primary-900 text-primary-600 dark:text-primary-400 rounded-lg text-sm font-medium hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
                            Show Heatmap ‚Üî
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto" id="rtmTableContainer">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-50 dark:bg-gray-700/50 sticky top-0 z-10">
                            <tr>
                                <th class="text-left py-3 px-4 font-medium text-gray-600 dark:text-gray-400">Req ID</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-600 dark:text-gray-400">Source Text</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-600 dark:text-gray-400">Classification</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-600 dark:text-gray-400">
                                    <select onchange="filterRTMPriority(this.value)" class="bg-transparent border border-gray-300 dark:border-gray-600 rounded px-2 py-1 text-xs cursor-pointer">
                                        <option value="all">Priority</option>
                                        <option value="High">High</option>
                                        <option value="Medium">Medium</option>
                                        <option value="Low">Low</option>
                                    </select>
                                </th>
                                <th class="text-left py-3 px-4 font-medium text-gray-600 dark:text-gray-400">Test Cases</th>
                                <th class="text-left py-3 px-4 font-medium text-gray-600 dark:text-gray-400">Coverage</th>
                            </tr>
                        </thead>
                    </table>
                    <div class="max-h-72 overflow-y-auto">
                        <table class="w-full text-sm">
                            <tbody id="rtmTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- RTM Heatmap -->
            <div id="rtmBack" class="hidden bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden">
                <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">Coverage Heatmap</h3>
                    <span class="text-xs text-gray-500 dark:text-gray-400">
                        <span class="inline-block w-3 h-3 rounded-sm bg-green-500 mr-1"></span>Positive
                        <span class="inline-block w-3 h-3 rounded-sm bg-red-500 ml-2 mr-1"></span>Negative
                        <span class="inline-block w-3 h-3 rounded-sm bg-yellow-500 ml-2 mr-1"></span>Edge
                        <span class="inline-block w-3 h-3 rounded-sm bg-blue-500 ml-2 mr-1"></span>Boundary
                    </span>
                </div>
                <div class="overflow-auto max-h-[500px]">
                    <table class="w-full text-xs" id="rtmHeatmap">
                        <thead class="bg-gray-50 dark:bg-gray-700/50 sticky top-0">
                            <tr id="heatmapHeader">
                                <th class="text-left py-2 px-2 font-medium text-gray-600 dark:text-gray-400 sticky left-0 bg-gray-50 dark:bg-gray-700/50 z-10 min-w-[60px]">Req</th>
                            </tr>
                        </thead>
                        <tbody id="rtmHeatmapBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Global State
        let appState = {
            rawRequirements: '',
            analyzedRequirements: [],
            selectedRequirementIds: new Set(),
            generatedArtifacts: null,
            currentFilter: 'all',
            rtmFilter: null,
            rtmPriorityFilter: 'all'
        };

        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const sunIcon = document.getElementById('sunIcon');
        const moonIcon = document.getElementById('moonIcon');
        const html = document.documentElement;
        
        const savedTheme = localStorage.getItem('theme') || 'light';
        html.classList.add(savedTheme);
        updateThemeIcon(savedTheme);
        
        themeToggle.addEventListener('click', () => {
            const currentTheme = html.classList.contains('dark') ? 'dark' : 'light';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.classList.remove(currentTheme);
            html.classList.add(newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        });
        
        function updateThemeIcon(theme) {
            if (theme === 'dark') {
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            } else {
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            }
        }

        // Page Navigation
        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active', 'text-primary-600', 'dark:text-primary-400'));
            
            document.getElementById(`page-${pageName}`).classList.add('active');
            document.querySelector(`[data-page="${pageName}"]`).classList.add('active', 'text-primary-600', 'dark:text-primary-400');
        }

        // Template Dropdown
        function toggleTemplateDropdown() {
            document.getElementById('templateDropdown').classList.toggle('hidden');
        }
        
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#templateDropdown') && !e.target.closest('[onclick="toggleTemplateDropdown()"]')) {
                document.getElementById('templateDropdown').classList.add('hidden');
            }
        });

        const templates = {
            flash_sale: 'The system shall display product details including price, stock quantity, and discount percentage. During flash sale events, limited stock shall be allocated on a first-come-first-serve basis. The system shall prevent overselling of stock during high concurrency. When a user adds a product to cart, the product shall be reserved for ten minutes. If checkout is not completed within ten minutes, the reserved stock shall be released automatically. The system shall process payments through integrated payment gateways. Payment response shall be received within five seconds. If payment is successful, order confirmation shall be generated immediately. If payment fails, stock shall be restored automatically. The system shall send confirmation email within one minute of successful order placement. The platform shall handle at least 5,000 transactions per second during flash sales. The system shall prevent duplicate order generation due to repeated submission or page refresh. All payment data shall comply with PCI standards. System availability during flash sale shall not fall below 99.95 percent.',
            parking: 'The system shall detect available parking slots using IoT sensors installed at each slot. Sensor data shall synchronize with the central server every 30 seconds. The system shall display real-time slot availability to users within two seconds of refresh. Users shall reserve a parking slot for a selected future time window. Reserved slots shall not be visible as available to other users. If a user does not enter the parking lot within fifteen minutes of reservation start time, the system shall release the slot automatically. The system shall start the parking session when vehicle entry is detected through RFID or license plate recognition. The system shall calculate parking fees based on duration and configured pricing rules. Overstay charges shall apply automatically after grace period expires. Users shall complete payment before exiting the parking lot. If payment fails, the system shall mark the session as pending payment and restrict future reservations. Operators shall configure pricing rules, operating hours, and total slot capacity through an administrative dashboard. The system shall generate daily occupancy reports and revenue summaries. The system shall handle 100,000 concurrent user sessions. System uptime shall not fall below 99.9 percent. If sensor data becomes unavailable, operators shall manually override slot availability.',
            food_delivery: 'The system shall allow customers to search restaurants based on location and cuisine type. The system shall display estimated delivery time and delivery charges before order confirmation. Customers shall add items to cart and modify item quantity before checkout. The system shall validate item availability before order placement. If an item becomes unavailable during checkout, the system shall notify the user and prevent order confirmation. Customers shall apply discount coupons during checkout. The system shall validate coupon eligibility based on expiration date and minimum order value. The system shall process payments using credit card, debit card, UPI, and wallet. Payment confirmation shall occur within five seconds. If payment is deducted but order creation fails, the system shall automatically initiate refund within ten minutes. The system shall assign delivery partners based on proximity and availability. Delivery partner location shall update every five seconds. Customers shall track order status in real time. The system shall allow cancellation before order preparation starts. The system shall support up to 150,000 concurrent users during peak hours. System availability shall be at least 99.9 percent uptime monthly. All personal and payment information shall be encrypted. The system shall prevent duplicate order creation if the user refreshes the confirmation page repeatedly.',
            wallet: 'The system shall allow users to register using a mobile number and email address. The system shall verify the mobile number using a one-time password before account activation. Users shall create a secure login PIN during registration. The system shall allow users to add money to their wallet using debit card, credit card, or UPI. The wallet balance shall update immediately after successful payment confirmation. If payment fails after deduction from the bank, the system shall automatically reconcile the transaction within five minutes. Users shall transfer money to another registered user using mobile number or wallet ID. The system shall prevent transfers if the sender\'s wallet balance is insufficient. The system shall block transfers exceeding ‚Çπ1,00,000 per day. All wallet transactions shall be recorded in transaction history. Transaction history shall display date, time, transaction ID, amount, and status. Users shall receive a push notification after every successful or failed transaction. The system shall support up to 75,000 concurrent active users. Transaction processing time shall not exceed two seconds under normal load. All financial data shall be encrypted at rest and in transit. The system shall comply with PCI-DSS standards. If the notification service fails, the transaction shall still complete successfully and the notification shall retry asynchronously.',
            telemedicine: 'The system shall allow patients to create an account using email and password. Email verification shall be mandatory before booking appointments. Patients shall book appointments based on doctor availability schedule. The system shall prevent double booking of time slots. Patients shall pay consultation fees before appointment confirmation. If payment fails after deduction, refund shall be processed automatically within fifteen minutes. The system shall enable secure video consultation between patient and doctor. Video latency shall not exceed 300 milliseconds under stable network conditions. Doctors shall create digital prescriptions including diagnosis, medication, dosage, and duration. Patients shall view prescription history but shall not edit prescription details. All medical records shall be encrypted and stored securely. The system shall comply with healthcare data privacy regulations. The platform shall support 10,000 concurrent consultation sessions. If the video connection drops, the system shall attempt automatic reconnection within ten seconds. If reconnection fails, the session shall be marked incomplete and partial refund shall be evaluated.',
            comprehensive_test: `1. The system shall authenticate users using username and password within 3 seconds. This requirement has clear actor, action, and time constraint. No ambiguity here. (HIGH PRIORITY - Authentication, Clear, Multiple Conditions: time constraint)
2. The system shall display the dashboard when the user logs in successfully. Simple and clear. (MEDIUM PRIORITY - Functional, Clear, No Conditions)
3. The data shall be processed quickly during peak hours. What does "quickly" mean? Who is the data processor? This has vague terms. (HIGH PRIORITY - Processing, VAGUE, Conditions: during peak hours)
4. The payment gateway shall handle transactions securely. No error handling specified. (FINANCIAL, VAGUE - Missing expected outcome)
5. When a user adds items to cart and checkout is not completed within 15 minutes, the system shall release the reserved inventory automatically. If payment processing fails, the system shall retry twice before marking the order as failed. Nested conditions: 1) checkout timeout, 2) payment retry logic. Clear actor and action. (HIGH PRIORITY - E-commerce, Clear, Multiple Conditions: timeout, payment retry)
6. The API shall accept JSON requests and return XML responses. Clear specification. (API, Clear, No Conditions)
7. Users should be able to generate reports as needed. Vague terms "as needed". What are the report types? (REPORTING, VAGUE)
8. The system shall support at least 100,000 concurrent sessions during normal operation and shall scale to handle 500,000 sessions during high load. Multiple capacity thresholds with different conditions. (SCALABILITY, Clear, Multiple Conditions: normal vs high load)
9. The administrator shall configure notification settings. Simple and clear. (USER MANAGEMENT, Clear, No Conditions)
10. If the validation fails, the system shall show an appropriate error message. Clear error handling specified. (VALIDATION, Clear, Conditions: validation fails)
11. The response time shall not exceed 200 milliseconds for 95th percentile requests under normal load. Specific performance metric. (PERFORMANCE, Clear, Conditions: 95th percentile, normal load)
12. The system may notify users about new features. Optional requirement with "may" - should this be included? (NOTIFICATION, VAGUE - Optional)
13. All sensitive data shall be encrypted using AES-256 before storage. Security requirement with specific algorithm. (SECURITY, Clear, No Conditions)
14. The integration shall work with third-party services when they are available. Conditional on external services. (INTEGRATION, VAGUE - Conditions depend on external)
15. Users shall complete payment before downloading purchased content. Clear precondition. (PAYMENT, Clear, Conditions: payment completion)`
        };

        function loadTemplate(key) {
            document.getElementById('requirementsInput').value = templates[key];
            updateCharCount();
            document.getElementById('templateDropdown').classList.add('hidden');
            showToast('Template loaded', 'success');
        }

        // Character Count
        const requirementsInput = document.getElementById('requirementsInput');
        const charCount = document.getElementById('charCount');
        
        requirementsInput.addEventListener('input', updateCharCount);
        
        function updateCharCount() {
            charCount.textContent = requirementsInput.value.length;
            appState.rawRequirements = requirementsInput.value;
        }

        // Toast Notifications
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            
            toast.className = `toast-enter px-4 py-3 rounded-lg shadow-lg text-white flex items-center gap-2 ${colors[type]}`;
            toast.innerHTML = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> ${message}`;
            
            container.appendChild(toast);
            requestAnimationFrame(() => {
                toast.classList.remove('toast-enter');
                toast.classList.add('toast-enter-active');
            });
            
            setTimeout(() => {
                toast.classList.remove('toast-enter-active');
                toast.classList.add('toast-exit-active');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // API Configuration - Removed backend dependency
        // Process Requirements entirely client-side

        // Process Requirements - Client-side implementation
        async function processRequirements() {
            const text = requirementsInput.value.trim();
            if (!text) {
                showToast('Please enter requirements', 'warning');
                return;
            }

            document.getElementById('requirementsInput').classList.add('hidden');
            document.getElementById('requirementsLoading').classList.remove('hidden');
            
            const progressBar = document.getElementById('reqProgressBar');
            progressBar.style.width = '0%';
            
            try {
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress = Math.min(progress + Math.random() * 15, 90);
                    progressBar.style.width = progress + '%';
                }, 200);

                // Process requirements client-side (simulated AI analysis)
                const data = await analyzeRequirements(text);

                clearInterval(progressInterval);
                progressBar.style.width = '100%';

                // Store analyzed requirements
                appState.analyzedRequirements = data.normalized_requirements || [];
                appState.selectedRequirementIds = new Set(appState.analyzedRequirements.map(r => r.requirement_id));
                
                // Update button text to "Deselect All" since all are selected
                document.getElementById('selectAllBtn').textContent = 'Deselect All';
                
                // Render requirements list
                renderRequirements(data.normalized_requirements || []);
                
                document.getElementById('requirementsLoading').classList.add('hidden');
                document.getElementById('aiAnalysisSection').classList.remove('hidden');
                
                showToast(`Analyzed ${data.normalized_requirements?.length || 0} requirements`, 'success');
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
                console.error(error);
                document.getElementById('requirementsLoading').classList.add('hidden');
                document.getElementById('requirementsInput').classList.remove('hidden');
            }
        }

        // Client-side Requirements Analysis
        async function analyzeRequirements(text) {
            return new Promise((resolve) => {
                // Split text into individual requirements and track line numbers
                const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 10);
                
                const normalizedRequirements = sentences.map((sentence, idx) => {
                    const reqId = `REQ-${String(idx + 1).padStart(3, '0')}`;
                    const normalized = normalizeRequirement(sentence);
                    const classification = classifyRequirement(sentence, normalized);
                    const ambiguity = detectAmbiguity(sentence, normalized);
                    
                    return {
                        requirement_id: reqId,
                        source_text: sentence.trim(),
                        source_line: idx + 1,
                        normalized: normalized,
                        classification: classification,
                        priority_hint: determinePriority(normalized, classification),
                        ambiguity: ambiguity,
                        provenance: {
                            confidence: calculateConfidence(normalized, ambiguity),
                            method: 'rule-based'
                        }
                    };
                });

                // Generate test cases for each requirement
                const testCases = generateTestCases(normalizedRequirements);
                
                // Generate test plan
                const testPlan = generateTestPlan(normalizedRequirements, testCases);

                setTimeout(() => {
                    resolve({
                        normalized_requirements: normalizedRequirements,
                        test_cases: testCases,
                        test_plan: testPlan
                    });
                }, 500); // Small delay for UX
            });
        }

        // Normalize requirement into Actor-Action-Conditions-Outcome format
        function normalizeRequirement(text) {
            const normalized = {
                actor: 'N/A',
                action: 'N/A',
                conditions: [],
                expected_outcome: 'N/A'
            };

            const lowerText = text.toLowerCase();
            
            // Detect actors
            const actors = [
                { keywords: ['user', 'customer', 'end user'], name: 'User' },
                { keywords: ['admin', 'administrator', 'operator'], name: 'Administrator' },
                { keywords: ['system', 'platform', 'application'], name: 'System' },
                { keywords: ['api', 'service', 'endpoint'], name: 'API' },
                { keywords: ['mobile app', 'web app', 'client'], name: 'Client' },
                { keywords: ['payment gateway', 'payment'], name: 'Payment System' }
            ];
            
            for (const actor of actors) {
                if (actor.keywords.some(k => lowerText.includes(k))) {
                    normalized.actor = actor.name;
                    break;
                }
            }
            
            // If no actor found, try to extract from beginning
            if (normalized.actor === 'N/A') {
                const words = text.split(' ');
                if (words[0].toLowerCase() === 'the') {
                    normalized.actor = words[1] ? words[1].charAt(0).toUpperCase() + words[1].slice(1) : 'User';
                }
            }

            // Detect actions
            const actions = [
                { keywords: ['login', 'sign in', 'authenticate'], name: 'Authenticate' },
                { keywords: ['logout', 'sign out', 'log out'], name: 'Logout' },
                { keywords: ['register', 'signup', 'create account'], name: 'Register' },
                { keywords: ['validate', 'verify', 'check'], name: 'Validate' },
                { keywords: ['display', 'show', 'render', 'present'], name: 'Display' },
                { keywords: ['save', 'store', 'persist', 'write'], name: 'Save' },
                { keywords: ['delete', 'remove', 'erase', 'cancel'], name: 'Delete' },
                { keywords: ['update', 'modify', 'edit', 'change'], name: 'Update' },
                { keywords: ['search', 'find', 'query'], name: 'Search' },
                { keywords: ['process', 'handle', 'execute'], name: 'Process' },
                { keywords: ['send', 'transmit', 'dispatch'], name: 'Send' },
                { keywords: ['receive', 'get', 'fetch'], name: 'Receive' },
                { keywords: ['calculate', 'compute', 'determine'], name: 'Calculate' },
                { keywords: ['encrypt', 'hash', 'secure'], name: 'Encrypt' },
                { keywords: ['notify', 'alert', 'inform'], name: 'Notify' },
                { keywords: ['book', 'reserve', 'schedule'], name: 'Book' },
                { keywords: ['pay', 'payment', 'checkout'], name: 'Process Payment' }
            ];
            
            for (const action of actions) {
                if (action.keywords.some(k => lowerText.includes(k))) {
                    normalized.action = action.name;
                    break;
                }
            }

            // Detect conditions
            const conditionPatterns = [
                { pattern: /within\s+(\d+)\s+(second|minute|hour)/gi, label: 'Time constraint' },
                { pattern: /if\s+(.+?)(?:,|\.)/gi, label: 'Conditional' },
                { pattern: /when\s+(.+?)(?:,|\.)/gi, label: 'Trigger' },
                { pattern: /unless\s+(.+?)(?:,|\.)/gi, label: 'Exception' },
                { pattern: /during\s+(.+?)(?:,|\.)/gi, label: 'Duration' },
                { pattern: /maximum\s+(\d+)/gi, label: 'Max limit' },
                { pattern: /minimum\s+(\d+)/gi, label: 'Min limit' },
                { pattern: /at\s+least\s+(\d+)/gi, label: 'Lower bound' },
                { pattern: /not\s+less\s+than/gi, label: 'Lower bound' }
            ];
            
            const foundConditions = [];
            conditionPatterns.forEach(cp => {
                let match;
                while ((match = cp.pattern.exec(text)) !== null) {
                    foundConditions.push(`${cp.label}: ${match[1] || match[0]}`);
                }
            });
            
            // Also look for numeric thresholds
            const numericMatches = text.match(/(\d+(?:,\d{3})*(?:\.\d+)?)\s*(?:users?|transactions?|concurrent|per\s+(?:second|minute|hour))/gi);
            if (numericMatches) {
                numericMatches.forEach(m => foundConditions.push(`Capacity: ${m}`));
            }
            
            normalized.conditions = foundConditions.slice(0, 5);

            // Detect expected outcome
            const outcomePatterns = [
                { pattern: /shall\s+(.+?)(?:\.|,)/gi, name: 'Expected behavior' },
                { pattern: /should\s+(.+?)(?:\.|,)/gi, name: 'Expected behavior' },
                { pattern: /must\s+(.+?)(?:\.|,)/gi, name: 'Required outcome' },
                { pattern: /will\s+(.+?)(?:\.|,)/gi, name: 'Outcome' },
                { pattern: /then\s+(.+?)(?:\.|,)/gi, name: 'Result' }
            ];
            
            for (const op of outcomePatterns) {
                let match = op.pattern.exec(text);
                if (match) {
                    normalized.expected_outcome = match[1].substring(0, 100) + (match[1].length > 100 ? '...' : '');
                    break;
                }
            }

            return normalized;
        }

        // Classify requirement type
        function classifyRequirement(text, normalized) {
            const classifications = [];
            const lowerText = text.toLowerCase();
            
            // Functional classification
            if (/login|auth|password|credential|token|session/i.test(text)) {
                classifications.push('Authentication');
            }
            if (/payment|credit|debit|transaction|refund|pay/i.test(text)) {
                classifications.push('Financial');
            }
            if (/search|filter|sort|query|find/i.test(text)) {
                classifications.push('Search');
            }
            if (/notification|email|alert|message|sms/i.test(text)) {
                classifications.push('Notification');
            }
            if (/report|analytics|metric|statistic|dashboard/i.test(text)) {
                classifications.push('Reporting');
            }
            if (/video|call|audio|conference|chat/i.test(text)) {
                classifications.push('Communication');
            }
            if (/booking|reservation|schedule|appointment/i.test(text)) {
                classifications.push('Scheduling');
            }
            if (/inventory|stock|product|item|cart/i.test(text)) {
                classifications.push('E-commerce');
            }
            if (/profile|account|setting|preference/i.test(text)) {
                classifications.push('User Management');
            }
            if (/api|endpoint|request|response|integration/i.test(text)) {
                classifications.push('API');
            }
            
            // Default to Functional if nothing matched
            if (classifications.length === 0) {
                classifications.push('Functional');
            }
            
            return classifications;
        }

        // Detect ambiguities in requirements
        function detectAmbiguity(text, normalized) {
            const ambiguity = {
                is_ambiguous: false,
                issues: [],
                clarifying_questions: []
            };

            // Check for vague terms
            const vagueTerms = ['should', 'could', 'maybe', 'possibly', 'perhaps', 'usually', 'normally', 'typically', 'as appropriate', 'as needed', 'timely', 'promptly', 'quickly', 'reasonably'];
            
            vagueTerms.forEach(term => {
                if (lowerText(text).includes(term)) {
                    ambiguity.is_ambiguous = true;
                    ambiguity.issues.push(`Vague term: "${term}"`);
                    ambiguity.clarifying_questions.push(`Please clarify what "${term}" means in this context.`);
                }
            });

            // Check for missing actor
            if (!normalized.actor || normalized.actor === 'N/A') {
                ambiguity.is_ambiguous = true;
                ambiguity.issues.push('Actor not specified');
                const action = normalized.action || 'this action';
                ambiguity.clarifying_questions.push(`Who is responsible for performing "${action}"?`);
            }

            // Check for missing action clarity
            if (normalized.action && normalized.action !== 'N/A' && /display|show|process|handle/i.test(normalized.action)) {
                ambiguity.clarifying_questions.push(`What exactly should be "${normalized.action.toLowerCase()}" and in what format?`);
            }

            // Check for numeric thresholds with context
            if (/\d+/.test(text)) {
                const numbers = text.match(/\d+/g);
                numbers.forEach(num => {
                    if (/\d{6,}/.test(num)) {
                        ambiguity.clarifying_questions.push(`What does the value "${num}" represent?`);
                    }
                    if (/5000|10000|15000|75000|100000/i.test(num)) {
                        ambiguity.clarifying_questions.push(`Is "${num}" the expected concurrent users, TPS, or capacity limit?`);
                    }
                    if (/5|10|15|30|60|300/i.test(num)) {
                        const timeUnit = text.match(/second|minute|hour/i);
                        if (timeUnit) {
                            ambiguity.clarifying_questions.push(`Is the ${num}${timeUnit[0].toLowerCase()} response time a hard SLA or target?`);
                        }
                    }
                });
            }

            // Check for concurrency requirements
            if (/concurrent|simultaneous|parallel/i.test(text)) {
                ambiguity.clarifying_questions.push('What is the expected maximum concurrency level?');
                ambiguity.clarifying_questions.push('Should the system reject requests when concurrency limit is reached, or queue them?');
            }

            // Check for missing expected outcome
            if (!normalized.expected_outcome || normalized.expected_outcome === 'N/A' || normalized.expected_outcome === text.substring(0, 100)) {
                ambiguity.clarifying_questions.push('What is the expected successful outcome when this requirement is met?');
            }

            // Check for error handling
            if (!/error|fail|exception|invalid|incorrect/i.test(text)) {
                ambiguity.clarifying_questions.push('What should happen if this requirement cannot be fulfilled?');
            }

            // Check for incomplete conditions
            const conditions = normalized.conditions || [];
            if (conditions.length === 0 && text.length > 50) {
                ambiguity.clarifying_questions.push('What conditions must be true before this requirement becomes active?');
            }

            // Check for payment/financial context
            if (/payment|pay|refund|charge/i.test(text) && !/currency|amount|INR|USD|Rs/i.test(text)) {
                ambiguity.clarifying_questions.push('What is the currency and maximum transaction amount?');
            }

            // Check for security context
            if (/encrypt|secure|privacy|compli/i.test(text) && !/standard|protocol|level/i.test(text)) {
                ambiguity.clarifying_questions.push('Which security standard or protocol should be followed?');
            }

            return ambiguity;
        }

        // Determine priority based on analysis
        function determinePriority(normalized, classification) {
            let priority = 'Medium';
            const classifications = classification || [];
            
            // Financial requirements are high priority
            if (classifications.includes('Financial') || classifications.includes('Payment')) {
                return 'High';
            }
            
            // Authentication is high priority
            if (classifications.includes('Authentication')) {
                return 'High';
            }
            
            // Security-related
            if (/encrypt|security|secure|protect|privacy/i.test(normalized.source_text || '')) {
                return 'High';
            }
            
            // Time-critical requirements
            if (/within \d+ second/i.test(normalized.source_text || '') || /performance|response time|latency/i.test(normalized.source_text || '')) {
                return 'High';
            }
            
            // Low priority for reporting, notifications
            if (classifications.includes('Reporting')) {
                return 'Low';
            }
            
            return priority;
        }

        // Calculate confidence score
        function calculateConfidence(normalized, ambiguity) {
            let confidence = 1.0;
            
            // Reduce confidence for ambiguous requirements
            if (ambiguity.is_ambiguous) {
                confidence -= 0.2;
            }
            
            // Reduce confidence for missing actor
            if (!normalized.actor || normalized.actor === 'N/A') {
                confidence -= 0.15;
            }
            
            // Reduce confidence for missing conditions in complex requirements
            const conditions = normalized.conditions || [];
            const sourceText = normalized.source_text || '';
            if (conditions.length === 0 && sourceText.length > 80) {
                confidence -= 0.1;
            }
            
            return Math.max(0.5, confidence);
        }

        // Generate test cases from requirements
        function generateTestCases(requirements) {
            const testCases = [];
            
            requirements.forEach(req => {
                const baseTc = {
                    mapped_requirement_id: req.requirement_id,
                    priority: req.priority_hint === 'High' ? 'P0' : req.priority_hint === 'Medium' ? 'P1' : 'P2'
                };

                // Positive test case
                testCases.push({
                    ...baseTc,
                    test_case_id: `TC-${req.requirement_id.split('-')[1]}-P001`,
                    title: `Verify ${req.action || 'requirement'} with valid input`,
                    test_type: 'Positive',
                    preconditions: [],
                    steps: [
                        { step_number: 1, action: `Initiate ${req.action || 'action'} with valid parameters` },
                        { step_number: 2, action: `Verify system processes the request` },
                        { step_number: 3, action: `Confirm ${req.expected_outcome || 'expected behavior'}` }
                    ],
                    expected_result: `${req.action || 'Action'} completed successfully with expected outcome`,
                    automation_feasibility: { feasible: true, notes: 'Standard flow' }
                });

                // Negative test cases
                testCases.push({
                    ...baseTc,
                    test_case_id: `TC-${req.requirement_id.split('-')[1]}-N001`,
                    title: `Verify ${req.action || 'requirement'} handles invalid input gracefully`,
                    test_type: 'Negative',
                    preconditions: [],
                    steps: [
                        { step_number: 1, action: `Attempt ${req.action || 'action'} with invalid/missing input` },
                        { step_number: 2, action: `Verify system rejects invalid input` },
                        { step_number: 3, action: `Confirm appropriate error message is displayed` }
                    ],
                    expected_result: 'System displays error message and does not process invalid input',
                    automation_feasibility: { feasible: true, notes: 'Error handling flow' }
                });

                // Boundary test if numeric values present
                if (/\d+/.test(req.source_text)) {
                    testCases.push({
                        ...baseTc,
                        test_case_id: `TC-${req.requirement_id.split('-')[1]}-B001`,
                        title: `Verify ${req.action || 'requirement'} at boundary values`,
                        test_type: 'Boundary',
                        preconditions: [],
                        steps: [
                            { step_number: 1, action: `Test with boundary values (min/max thresholds)` },
                            { step_number: 2, action: `Verify behavior at exactly threshold values` },
                            { step_number: 3, action: `Confirm handling of values just below/above thresholds` }
                        ],
                        expected_result: 'System handles boundary values correctly',
                        automation_feasibility: { feasible: true, notes: 'Boundary analysis' }
                    });
                }

                // Edge case if concurrency mentioned
                if (/concurrent|simultaneous|parallel/i.test(req.source_text)) {
                    testCases.push({
                        ...baseTc,
                        test_case_id: `TC-${req.requirement_id.split('-')[1]}-E001`,
                        title: `Verify ${req.action || 'requirement'} under concurrent access`,
                        test_type: 'Edge',
                        preconditions: ['Multiple user sessions active'],
                        steps: [
                            { step_number: 1, action: `Initiate ${req.action || 'action'} from multiple sessions simultaneously` },
                            { step_number: 2, action: `Verify system handles concurrent requests` },
                            { step_number: 3, action: `Confirm data consistency across all sessions` }
                        ],
                        expected_result: 'All concurrent requests processed correctly without data corruption',
                        automation_feasibility: { feasible: false, notes: 'Requires load testing setup' }
                    });
                }

                // Error handling test
                if (!/error|fail|exception/i.test(req.source_text)) {
                    testCases.push({
                        ...baseTc,
                        test_case_id: `TC-${req.requirement_id.split('-')[1]}-E002`,
                        title: `Verify ${req.action || 'requirement'} handles system failures`,
                        test_type: 'Negative',
                        preconditions: ['Simulate system failure conditions'],
                        steps: [
                            { step_number: 1, action: `Trigger failure condition during ${req.action || 'action'}` },
                            { step_number: 2, action: `Verify system responds appropriately to failure` },
                            { step_number: 3, action: `Confirm system recovers or provides appropriate feedback` }
                        ],
                        expected_result: 'System handles failure gracefully with appropriate error handling',
                        automation_feasibility: { feasible: false, notes: 'Chaos testing required' }
                    });
                }
            });

            return testCases;
        }

        // Generate test plan
        function generateTestPlan(requirements, testCases) {
            const priorityCounts = { P0: 0, P1: 0, P2: 0 };
            testCases.forEach(tc => {
                if (priorityCounts[tc.priority] !== undefined) {
                    priorityCounts[tc.priority]++;
                }
            });

            const typeCounts = {};
            testCases.forEach(tc => {
                typeCounts[tc.test_type] = (typeCounts[tc.test_type] || 0) + 1;
            });

            const testTypes = Object.keys(typeCounts);
            
            return {
                plan_id: `TP-${new Date().toISOString().slice(0, 10).replace(/-/g, '')}`,
                version: '1.0',
                objectives: 'Validate that all specified requirements are met through comprehensive test coverage including functional, boundary, and edge case testing.',
                scope: `Testing ${requirements.length} requirements generating ${testCases.length} test cases covering ${testTypes.length} test types.`,
                test_strategy: {
                    // Section 1: Scope and Overview
                    objectives: 'Ensure functional correctness, boundary handling, and error resilience',
                    scope: 'Full regression testing of specified requirements',
                    approval_authority: 'Business Team, Project Management, Development Lead',
                    testing_activities: 'Unit Testing, Integration Testing, System Testing, UAT',
                    
                    // Section 2: Testing Methodology
                    levels: 'Unit Testing, Integration Testing, System Testing, UAT',
                    team_roles: 'QA Lead, Test Engineers, Developers, Business Analysts',
                    change_management: 'Process for handling Change Requests (CR) and scope modifications',
                    defect_management: 'Defect triage, re-testing, regression testing, and sign-off procedures',
                    
                    // Section 3: Test Environment
                    environments: 'Development, QA, Staging environments as required',
                    test_data_requirements: 'Data preparation, masking, and validation procedures',
                    backup_restore: 'Test data backup strategy and recovery procedures',
                    environment_count: 'Minimum required environments based on project complexity',
                    
                    // Section 4: Testing Tools
                    test_management_tool: 'Test case management and traceability tools',
                    automation_tool: 'Selenium, Cypress, Playwright, or similar',
                    performance_tool: 'JMeter, LoadRunner, or similar for load testing',
                    security_tool: 'OWASP ZAP, Burp Suite, or similar security tools',
                    
                    // Section 5: Release Control
                    release_management: 'Version-controlled release planning with history tracking',
                    test_execution_strategy: 'Structured test execution based on release cycles',
                    regression_testing: 'Automated regression suite execution per release',
                    signoff_criteria: 'Pass rates, critical defect closure, and coverage thresholds',
                    
                    // Section 6: Risk Analysis
                    risks: 'Schedule constraints, resource availability, environment dependencies',
                    mitigation_strategies: 'Proactive risk monitoring and contingency planning',
                    contingency_plan: 'Fallback strategies for high-impact risk scenarios',
                    priority_focus: 'High priority (P0) tests cover critical path and financial/security requirements',
                    
                    // Section 7: Review and Approvals
                    reviewers: 'System Administration, Project Management, Development, Business Teams',
                    approval_signoff: 'Document approval with name, date, and comments',
                    review_summary: 'Tracked changes and improvement recommendations',
                    process_updates: 'Continuous improvement based on review feedback',
                    
                    // Legacy fields for compatibility
                    approach: 'Risk-based testing with priority P0 tests executed first, followed by P1 and P2',
                    test_types_covered: testTypes
                },
                test_scenarios: requirements.map((req, idx) => ({
                    scenario_id: `SCN-${String(idx + 1).padStart(3, '0')}`,
                    requirement_id: req.requirement_id,
                    description: `Test scenario for: ${req.source_text.substring(0, 100)}...`,
                    priority: req.priority_hint,
                    preconditions: [],
                    test_cases: testCases.filter(tc => tc.mapped_requirement_id === req.requirement_id).map(tc => tc.test_case_id)
                })),
                metrics: {
                    total_requirements: requirements.length,
                    total_test_cases: testCases.length,
                    coverage_percentage: Math.min(100, Math.round((testCases.length / Math.max(requirements.length * 4, 1)) * 100)),
                    priority_distribution: priorityCounts,
                    type_distribution: typeCounts
                },
                rtm: requirements.map(req => ({
                    requirement_id: req.requirement_id,
                    source_text: req.source_text,
                    classification: req.classification,
                    priority: req.priority_hint,
                    test_cases: testCases.filter(tc => tc.mapped_requirement_id === req.requirement_id).map(tc => tc.test_case_id),
                    coverage: '100%'
                }))
            };
        }

        function lowerText(text) { return text.toLowerCase(); }

        function renderRequirements(requirements) {
            const container = document.getElementById('requirementsList');
            
            // Apply filters
            const priorityFilter = document.getElementById('priorityFilter')?.value || 'all';
            const confidenceFilter = document.getElementById('confidenceFilter')?.value || 'all';
            
            const filteredRequirements = requirements.filter(req => {
                // Priority filter
                if (priorityFilter !== 'all' && req.priority_hint !== priorityFilter) {
                    return false;
                }
                
                // Confidence filter
                const confidence = Math.round((req.provenance?.confidence || 1) * 100);
                if (confidenceFilter !== 'all') {
                    if (confidenceFilter === 'high' && confidence < 80) return false;
                    if (confidenceFilter === 'medium' && (confidence < 60 || confidence >= 80)) return false;
                    if (confidenceFilter === 'low' && confidence >= 60) return false;
                }
                
                return true;
            });
            
            const html = filteredRequirements.map((req, idx) => {
                const isSelected = appState.selectedRequirementIds.has(req.requirement_id);
                const priorityColors = {
                    'High': 'bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300',
                    'Medium': 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300',
                    'Low': 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300'
                };
                const confidence = Math.round((req.provenance?.confidence || 1) * 100);
                const confidenceColor = confidence >= 80 ? 'text-green-600' : confidence >= 60 ? 'text-yellow-600' : 'text-red-600';
                
                // Generate specific clarifying questions based on missing info
                const clarifyingQuestions = [];
                if (!req.normalized?.actor || req.normalized.actor === 'N/A') {
                    clarifyingQuestions.push(`Who is the actor performing "${req.normalized?.action || 'this action'}"?`);
                }
                if (req.normalized?.conditions?.length === 0 && req.source_text.length > 60) {
                    clarifyingQuestions.push('What conditions must be met before this requirement applies?');
                }
                if (req.ambiguity?.clarifying_questions) {
                    req.ambiguity.clarifying_questions.forEach(q => clarifyingQuestions.push(q));
                }
                
                return `
                    <div class="bg-white dark:bg-gray-800 rounded-xl border-2 ${isSelected ? 'border-primary-500' : 'border-gray-200 dark:border-gray-600'} p-4 transition-all">
                        <div class="flex items-start">
                            <div class="flex-shrink-0 mr-4">
                                <input type="checkbox" ${isSelected ? 'checked' : ''} class="w-5 h-5 rounded border-gray-300 text-primary-600 focus:ring-primary-500 cursor-pointer" onclick="toggleRequirement('${req.requirement_id}')">
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded text-xs font-medium">${req.requirement_id}</span>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-3 group relative cursor-help" title="Hover to see source">
                                    ${req.source_text}
                                    <span class="absolute left-0 bottom-full mb-2 hidden group-hover:block z-10 w-96 p-3 bg-gray-900 dark:bg-gray-700 text-white text-xs rounded-lg shadow-lg">
                                        <span class="font-medium block mb-1">Source (Line ${req.source_line}):</span>
                                        ${req.source_text}
                                    </span>
                                </p>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-xs text-gray-500 dark:text-gray-400">
                                    <div><span class="font-medium text-gray-700 dark:text-gray-300">Actor:</span> ${req.normalized?.actor || 'N/A'}</div>
                                    <div><span class="font-medium text-gray-700 dark:text-gray-300">Action:</span> ${req.normalized?.action || 'N/A'}</div>
                                    <div class="cursor-help group relative" title="Hover to see conditions">
                                        <span class="font-medium text-gray-700 dark:text-gray-300">Conditions:</span> ${req.normalized?.conditions?.length || 0}
                                        ${req.normalized?.conditions?.length > 0 ? `
                                            <span class="absolute left-0 bottom-full mb-2 hidden group-hover:block z-10 w-80 p-2 bg-gray-900 dark:bg-gray-700 text-white text-xs rounded-lg shadow-lg">
                                                <span class="font-medium block mb-1">Detected Conditions:</span>
                                                <ul class="list-disc list-inside">
                                                    ${(req.normalized?.conditions || []).map(c => `<li>${c}</li>`).join('')}
                                                </ul>
                                            </span>
                                        ` : ''}
                                    </div>
                                    <div class="${confidenceColor}"><span class="font-medium">Confidence:</span> ${confidence}%</div>
                                </div>
                            </div>
                            <div class="flex-shrink-0 ml-4 flex flex-col items-end gap-2">
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${priorityColors[req.priority_hint] || 'bg-gray-200 text-gray-700'}">${req.priority_hint}</span>
                                <span class="px-2 py-1 bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300 rounded text-xs">${(req.classification || []).join(', ')}</span>
                            </div>
                        </div>
                        ${clarifyingQuestions.length > 0 ? `
                            <div class="mt-3 pt-3 border-t border-gray-100 dark:border-gray-700">
                                <div class="text-xs font-medium text-amber-600 dark:text-amber-400 mb-1">Clarifying Questions:</div>
                                ${clarifyingQuestions.map(q => `<div class="text-xs text-amber-700 dark:text-amber-300">‚Ä¢ ${q}</div>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
        }

        function filterRequirements() {
            renderRequirements(appState.analyzedRequirements);
        }

        function toggleRequirement(reqId) {
            if (appState.selectedRequirementIds.has(reqId)) {
                appState.selectedRequirementIds.delete(reqId);
            } else {
                appState.selectedRequirementIds.add(reqId);
            }
            renderRequirements(appState.analyzedRequirements);
        }

        function toggleSelectAll() {
            const allSelected = appState.selectedRequirementIds.size === appState.analyzedRequirements.length;
            
            if (allSelected) {
                // Deselect all
                appState.selectedRequirementIds.clear();
                document.getElementById('selectAllBtn').textContent = 'Select All';
            } else {
                // Select all
                appState.analyzedRequirements.forEach(r => appState.selectedRequirementIds.add(r.requirement_id));
                document.getElementById('selectAllBtn').textContent = 'Deselect All';
            }
            
            renderRequirements(appState.analyzedRequirements);
        }

        function clearRequirements() {
            requirementsInput.value = '';
            updateCharCount();
            appState.analyzedRequirements = [];
            appState.selectedRequirementIds.clear();
            document.getElementById('requirementsInput').classList.remove('hidden');
            document.getElementById('requirementsLoading').classList.add('hidden');
            document.getElementById('aiAnalysisSection').classList.add('hidden');
            showToast('Input cleared', 'info');
        }

        // Generate Artifacts from Selected Requirements - Client-side
        async function generateFromSelected() {
            if (appState.selectedRequirementIds.size === 0) {
                showToast('Please select at least one requirement', 'warning');
                return;
            }

            // Filter artifacts to selected requirements
            const selectedReqs = appState.analyzedRequirements.filter(r => appState.selectedRequirementIds.has(r.requirement_id));
            
            // Generate artifacts object client-side
            const testCases = generateTestCases(selectedReqs);
            const testPlan = generateTestPlan(selectedReqs, testCases);
            
            appState.generatedArtifacts = {
                normalized_requirements: selectedReqs,
                test_cases: testCases,
                test_plan: testPlan
            };

            // Render artifacts
            renderTestPlan(appState.generatedArtifacts.test_plan);
            renderTestStrategy(appState.generatedArtifacts.test_plan?.test_strategy);
            renderTestScenarios(appState.generatedArtifacts.test_plan?.test_scenarios || [], appState.generatedArtifacts.normalized_requirements);
            renderTestCases(appState.generatedArtifacts.test_cases || []);
            renderRTM(appState.generatedArtifacts);
            
            showPage('artifacts');
            switchArtifactTab('testcases'); // Set Test Cases as default tab
            showToast('Artifacts generated successfully!', 'success');
        }

        // Artifact Tabs
        function switchArtifactTab(tabName) {
            document.querySelectorAll('.artifact-content').forEach(t => t.classList.add('hidden'));
            document.querySelectorAll('.artifact-tab').forEach(b => {
                b.classList.remove('border-primary-500', 'text-primary-600');
                b.classList.add('border-transparent', 'text-gray-600', 'dark:text-gray-400');
            });
            
            document.getElementById(`artifact-${tabName}`).classList.remove('hidden');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('border-primary-500', 'text-primary-600');
            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('border-transparent', 'text-gray-600', 'dark:text-gray-400');
        }

        // Filter Test Cases
        function filterTestCases(filter) {
            console.log('filterTestCases called with:', filter);
            appState.currentFilter = filter;
            
            // Handle RTM stat card filters
            if (filter.startsWith('rtm-')) {
                const rtmFilter = filter;
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                    btn.classList.add('bg-white', 'dark:bg-gray-600', 'text-gray-700', 'dark:text-gray-300', 'border', 'border-gray-200', 'dark:border-gray-500');
                });
                // Switch to test cases tab if not already there
                switchArtifactTab('testcases');
                // Store RTM filter for special handling in renderTestCases
                appState.rtmFilter = rtmFilter;
                renderTestCases(appState.generatedArtifacts?.test_cases || []);
                return;
            }
            
            // Clear RTM filter for standard filters
            appState.rtmFilter = null;
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.dataset.filter === filter) {
                    btn.classList.add('active');
                    btn.classList.remove('bg-white', 'dark:bg-gray-600', 'text-gray-700', 'dark:text-gray-300', 'border', 'border-gray-200', 'dark:border-gray-500');
                } else {
                    btn.classList.remove('active');
                    btn.classList.add('bg-white', 'dark:bg-gray-600', 'text-gray-700', 'dark:text-gray-300', 'border', 'border-gray-200', 'dark:border-gray-500');
                }
            });
            renderTestCases(appState.generatedArtifacts?.test_cases || []);
        }

        // Render Test Plan
        function renderTestPlan(testPlan) {
            const container = document.getElementById('testPlanContent');
            if (!testPlan) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400">No test plan available</p>';
                return;
            }

            const html = `
                <div class="space-y-6">
                    <!-- Header with Download Options -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-800 dark:text-white">Test Plan Document</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Plan ID: ${testPlan.plan_id} | Version: ${testPlan.version}</p>
                            </div>
                            <div class="flex items-center gap-2">
                                <button onclick="downloadDocument('testplan', 'md')" class="px-3 py-1.5 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 rounded-lg text-sm flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                                    MD
                                </button>
                                <button onclick="downloadDocument('testplan', 'doc')" class="px-3 py-1.5 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 rounded-lg text-sm flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                                    DOC
                                </button>
                                <button onclick="downloadDocument('testplan', 'pdf')" class="px-3 py-1.5 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 hover:bg-red-200 dark:hover:bg-red-900/50 rounded-lg text-sm flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                                    PDF
                                </button>
                            </div>
                        </div>
                        <div class="grid grid-cols-4 gap-4">
                            <div><span class="text-sm text-gray-500">Created:</span> <span class="font-medium text-gray-700 dark:text-gray-300">${new Date().toLocaleDateString()}</span></div>
                            <div><span class="text-sm text-gray-500">Status:</span> <span class="font-medium text-green-600">Draft</span></div>
                            <div><span class="text-sm text-gray-500">Requirements:</span> <span class="font-medium text-gray-700 dark:text-gray-300">${testPlan.metrics?.total_requirements || 0}</span></div>
                            <div><span class="text-sm text-gray-500">Test Cases:</span> <span class="font-medium text-gray-700 dark:text-gray-300">${testPlan.metrics?.total_test_cases || 0}</span></div>
                        </div>
                    </div>
                    
                    <!-- Section 1.0: Introduction -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded text-blue-600 dark:text-blue-400 text-xs flex items-center justify-center">1.0</span>
                            Introduction
                        </h4>
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                            <p class="text-gray-600 dark:text-gray-300 text-sm">${testPlan.introduction || 'This document provides a comprehensive summary of the product being tested and outlines all functions at a high level. The test plan defines the scope, objectives, approach, and resources required for successful testing of the system.'}</p>
                        </div>
                    </div>
                    
                    <!-- Section 2.0: Objectives and Tasks -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded text-blue-600 dark:text-blue-400 text-xs flex items-center justify-center">2.0</span>
                            Objectives and Tasks
                        </h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">2.1 Objectives</h5>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">${testPlan.objectives || 'Define testing objectives, tasks, responsibilities, and establish communication channels. This plan serves as a vehicle for coordination between testing team and stakeholders.'}</p>
                            </div>
                            <div>
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">2.2 Tasks</h5>
                                <ul class="text-gray-600 dark:text-gray-400 text-sm list-disc list-inside space-y-1">
                                    <li>Test Case Design and Development</li>
                                    <li>Test Execution</li>
                                    <li>Defect Reporting and Tracking</li>
                                    <li>Test Summary and Reporting</li>
                                    <li>Post-testing Activities</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 3.0: Scope -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded text-blue-600 dark:text-blue-400 text-xs flex items-center justify-center">3.0</span>
                            Scope
                        </h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">General</h5>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">${testPlan.scope || 'Testing covers new functions, existing interfaces, and integration of all components as defined in the requirements specification.'}</p>
                            </div>
                            <div>
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tactics</h5>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Testing will follow a risk-based approach prioritizing critical functionality. Key stakeholders will be notified and scheduled to assist in testing activities.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 4.0: Testing Strategy -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded text-blue-600 dark:text-blue-400 text-xs flex items-center justify-center">4.0</span>
                            Testing Strategy
                        </h4>
                        <div class="space-y-4">
                            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">4.1 Unit Testing</h5>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Individual components tested in isolation. Minimum 80% code coverage required. Developers responsible for unit testing.</p>
                            </div>
                            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">4.2 System and Integration Testing</h5>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Full system testing and integration testing to verify component interactions. QA team conducts these tests.</p>
                            </div>
                            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">4.3 Performance and Stress Testing</h5>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Load testing, stress testing, and performance benchmarking under expected and peak conditions.</p>
                            </div>
                            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">4.4 User Acceptance Testing</h5>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">End-users validate system against business requirements. Sign-off required before production release.</p>
                            </div>
                            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">4.5 Batch Testing</h5>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Automated batch jobs and scheduled processes validation.</p>
                            </div>
                            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">4.6 Automated Regression Testing</h5>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Automated test suites executed to verify no unintended effects from changes. Critical for continuous delivery.</p>
                            </div>
                            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">4.7 Beta Testing</h5>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Limited release to external users for real-world feedback before general availability.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 5.0: Hardware Requirements -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded text-blue-600 dark:text-blue-400 text-xs flex items-center justify-center">5.0</span>
                            Hardware Requirements
                        </h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Computers</h5>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Development workstations, QA testing environments, and build servers as per project specifications.</p>
                            </div>
                            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Modems/Network</h5>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Network connectivity for distributed testing and integration testing requirements.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 6.0: Environment Requirements -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded text-blue-600 dark:text-blue-400 text-xs flex items-center justify-center">6.0</span>
                            Environment Requirements
                        </h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">6.1 Main Frame</h5>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Production-like environment with necessary hardware, communications, and system software. Security level as per enterprise standards.</p>
                            </div>
                            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">6.2 Workstation</h5>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">End-user workstations matching production configuration for UAT and compatibility testing.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 7.0: Test Schedule -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded text-blue-600 dark:text-blue-400 text-xs flex items-center justify-center">7.0</span>
                            Test Schedule
                        </h4>
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                            <p class="text-gray-600 dark:text-gray-400 text-sm">Timeline aligned with project milestones. Each testing phase (Unit, Integration, System, UAT) scheduled with estimated effort. Resources allocated per testing task.</p>
                        </div>
                    </div>
                    
                    <!-- Section 8.0: Control Procedures -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded text-blue-600 dark:text-blue-400 text-xs flex items-center justify-center">8.0</span>
                            Control Procedures
                        </h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Problem Reporting</h5>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Standard incident logging procedure. Defects tracked with severity, priority, and status. Resolution timeline based on severity levels.</p>
                            </div>
                            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Change Requests</h5>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Change management process with sign-off criteria. Impact analysis for affected modules. Regression testing required for changes.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 9.0: Features to be Tested -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded text-blue-600 dark:text-blue-400 text-xs flex items-center justify-center">9.0</span>
                            Features to be Tested
                        </h4>
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                            <p class="text-gray-600 dark:text-gray-400 text-sm">${testPlan.metrics?.total_requirements || 0} requirements identified for testing. Coverage includes all functional requirements, integration points, and critical business workflows.</p>
                        </div>
                    </div>
                    
                    <!-- Section 10.0: Features Not to be Tested -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded text-blue-600 dark:text-blue-400 text-xs flex items-center justify-center">10.0</span>
                            Features Not to be Tested
                        </h4>
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                            <p class="text-gray-600 dark:text-gray-400 text-sm">Third-party components tested by vendors, previously tested stable features (with regression coverage only), and non-functional aspects covered under separate test plans.</p>
                        </div>
                    </div>
                    
                    <!-- Section 11.0: Resources/Roles & Responsibilities -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded text-blue-600 dark:text-blue-400 text-xs flex items-center justify-center">11.0</span>
                            Resources/Roles & Responsibilities
                        </h4>
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div><span class="font-medium text-gray-700 dark:text-gray-300">QA Lead:</span> <span class="text-gray-600 dark:text-gray-400">Overall test coordination and management</span></div>
                                <div><span class="font-medium text-gray-700 dark:text-gray-300">Test Engineers:</span> <span class="text-gray-600 dark:text-gray-400">Test case design and execution</span></div>
                                <div><span class="font-medium text-gray-700 dark:text-gray-300">Developers:</span> <span class="text-gray-600 dark:text-gray-400">Unit testing and defect fixes</span></div>
                                <div><span class="font-medium text-gray-700 dark:text-gray-300">Business Analysts:</span> <span class="text-gray-600 dark:text-gray-400">Requirements clarification and UAT support</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 12.0: Schedules -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded text-blue-600 dark:text-blue-400 text-xs flex items-center justify-center">12.0</span>
                            Schedules
                        </h4>
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                            <p class="text-gray-600 dark:text-gray-400 text-sm mb-2">Major Deliverables:</p>
                            <ul class="text-gray-600 dark:text-gray-400 text-sm list-disc list-inside space-y-1">
                                <li>Test Plan Document</li>
                                <li>Test Cases Document</li>
                                <li>Test Incident Reports</li>
                                <li>Test Summary Reports</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Section 13.0: Significantly Impacted Departments -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded text-blue-600 dark:text-blue-400 text-xs flex items-center justify-center">13.0</span>
                            Significantly Impacted Departments (SIDs)
                        </h4>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="bg-gray-100 dark:bg-gray-700">
                                        <th class="text-left py-2 px-3 text-gray-700 dark:text-gray-300">Department/Business Area</th>
                                        <th class="text-left py-2 px-3 text-gray-700 dark:text-gray-300">Bus. Manager</th>
                                        <th class="text-left py-2 px-3 text-gray-700 dark:text-gray-300">Tester(s)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-b border-gray-200 dark:border-gray-600">
                                        <td class="py-2 px-3 text-gray-600 dark:text-gray-400">QA Team</td>
                                        <td class="py-2 px-3 text-gray-600 dark:text-gray-400"><input type="text" placeholder="Enter name" class="bg-transparent border-b border-gray-300 dark:border-gray-600 w-24 text-xs"></td>
                                        <td class="py-2 px-3 text-gray-600 dark:text-gray-400"><input type="text" placeholder="Enter name" class="bg-transparent border-b border-gray-300 dark:border-gray-600 w-24 text-xs"></td>
                                    </tr>
                                    <tr class="border-b border-gray-200 dark:border-gray-600">
                                        <td class="py-2 px-3 text-gray-600 dark:text-gray-400">Development</td>
                                        <td class="py-2 px-3 text-gray-600 dark:text-gray-400"><input type="text" placeholder="Enter name" class="bg-transparent border-b border-gray-300 dark:border-gray-600 w-24 text-xs"></td>
                                        <td class="py-2 px-3 text-gray-600 dark:text-gray-400"><input type="text" placeholder="Enter name" class="bg-transparent border-b border-gray-300 dark:border-gray-600 w-24 text-xs"></td>
                                    </tr>
                                    <tr>
                                        <td class="py-2 px-3 text-gray-600 dark:text-gray-400">Business/Operations</td>
                                        <td class="py-2 px-3 text-gray-600 dark:text-gray-400"><input type="text" placeholder="Enter name" class="bg-transparent border-b border-gray-300 dark:border-gray-600 w-24 text-xs"></td>
                                        <td class="py-2 px-3 text-gray-600 dark:text-gray-400"><input type="text" placeholder="Enter name" class="bg-transparent border-b border-gray-300 dark:border-gray-600 w-24 text-xs"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Section 14.0: Dependencies -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded text-blue-600 dark:text-blue-400 text-xs flex items-center justify-center">14.0</span>
                            Dependencies
                        </h4>
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                            <p class="text-gray-600 dark:text-gray-400 text-sm">Test item availability, testing-resource availability, environment readiness, and stakeholder availability for UAT. Dependencies on third-party systems for integration testing.</p>
                        </div>
                    </div>
                    
                    <!-- Section 15.0: Risks/Assumptions -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded text-blue-600 dark:text-blue-400 text-xs flex items-center justify-center">15.0</span>
                            Risks/Assumptions
                        </h4>
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                            <p class="text-gray-600 dark:text-gray-400 text-sm">High-risk assumptions identified. Contingency plans for delays in test item delivery (increased night shift), resource constraints (cross-training), and environment issues (fallback environments).</p>
                        </div>
                    </div>
                    
                    <!-- Section 16.0: Tools -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded text-blue-600 dark:text-blue-400 text-xs flex items-center justify-center">16.0</span>
                            Tools
                        </h4>
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                            <p class="text-gray-600 dark:text-gray-400 text-sm mb-2">Automation Tools: Selenium, Cypress, or similar</p>
                            <p class="text-gray-600 dark:text-gray-400 text-sm mb-2">Bug Tracking: Jira, Bugzilla, or similar</p>
                            <p class="text-gray-600 dark:text-gray-400 text-sm mb-2">Test Management: TestRail, Zephyr, or similar</p>
                            <p class="text-gray-600 dark:text-gray-400 text-sm">Performance Testing: JMeter, LoadRunner, or similar</p>
                        </div>
                    </div>
                    
                    <!-- Section 17.0: Approvals -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded text-blue-600 dark:text-blue-400 text-xs flex items-center justify-center">17.0</span>
                            Approvals
                        </h4>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="bg-gray-100 dark:bg-gray-700">
                                        <th class="text-left py-2 px-3 text-gray-700 dark:text-gray-300">Name (In Capital Letters)</th>
                                        <th class="text-left py-2 px-3 text-gray-700 dark:text-gray-300">Signature</th>
                                        <th class="text-left py-2 px-3 text-gray-700 dark:text-gray-300">Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-b border-gray-200 dark:border-gray-600">
                                        <td class="py-2 px-3"><input type="text" placeholder="ENTER NAME" class="bg-transparent border-b border-gray-300 dark:border-gray-600 w-full text-xs"></td>
                                        <td class="py-2 px-3"><input type="text" placeholder="SIGNATURE" class="bg-transparent border-b border-gray-300 dark:border-gray-600 w-full text-xs"></td>
                                        <td class="py-2 px-3"><input type="date" class="bg-transparent border-b border-gray-300 dark:border-gray-600 w-full text-xs"></td>
                                    </tr>
                                    <tr class="border-b border-gray-200 dark:border-gray-600">
                                        <td class="py-2 px-3"><input type="text" placeholder="ENTER NAME" class="bg-transparent border-b border-gray-300 dark:border-gray-600 w-full text-xs"></td>
                                        <td class="py-2 px-3"><input type="text" placeholder="SIGNATURE" class="bg-transparent border-b border-gray-300 dark:border-gray-600 w-full text-xs"></td>
                                        <td class="py-2 px-3"><input type="date" class="bg-transparent border-b border-gray-300 dark:border-gray-600 w-full text-xs"></td>
                                    </tr>
                                    <tr class="border-b border-gray-200 dark:border-gray-600">
                                        <td class="py-2 px-3"><input type="text" placeholder="ENTER NAME" class="bg-transparent border-b border-gray-300 dark:border-gray-600 w-full text-xs"></td>
                                        <td class="py-2 px-3"><input type="text" placeholder="SIGNATURE" class="bg-transparent border-b border-gray-300 dark:border-gray-600 w-full text-xs"></td>
                                        <td class="py-2 px-3"><input type="date" class="bg-transparent border-b border-gray-300 dark:border-gray-600 w-full text-xs"></td>
                                    </tr>
                                    <tr>
                                        <td class="py-2 px-3"><input type="text" placeholder="ENTER NAME" class="bg-transparent border-b border-gray-300 dark:border-gray-600 w-full text-xs"></td>
                                        <td class="py-2 px-3"><input type="text" placeholder="SIGNATURE" class="bg-transparent border-b border-gray-300 dark:border-gray-600 w-full text-xs"></td>
                                        <td class="py-2 px-3"><input type="date" class="bg-transparent border-b border-gray-300 dark:border-gray-600 w-full text-xs"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML = html;
        }

        // Render Test Strategy
        function renderTestStrategy(strategy) {
            const container = document.getElementById('testStrategyContent');
            if (!strategy) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400">No test strategy available</p>';
                return;
            }

            const html = `
                <div class="space-y-6">
                    <!-- Header with Download Options -->
                    <div class="bg-gradient-to-r from-primary-500 to-primary-700 rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-xl font-bold">Test Strategy Document</h3>
                            <div class="flex items-center gap-2">
                                <button onclick="downloadDocument('strategy', 'md')" class="px-3 py-1.5 bg-white/20 hover:bg-white/30 rounded-lg text-sm flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                                    MD
                                </button>
                                <button onclick="downloadDocument('strategy', 'doc')" class="px-3 py-1.5 bg-white/20 hover:bg-white/30 rounded-lg text-sm flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                                    DOC
                                </button>
                                <button onclick="downloadDocument('strategy', 'pdf')" class="px-3 py-1.5 bg-red-500/50 hover:bg-red-500/70 rounded-lg text-sm flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                                    PDF
                                </button>
                            </div>
                        </div>
                        <p class="text-primary-100">Strategic approach to validating ${strategy.scope?.toLowerCase() || 'requirements'}</p>
                    </div>
                    
                    <!-- Section 1: Scope and Overview -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-2">
                            <span class="w-8 h-8 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center text-blue-600 dark:text-blue-400">1</span>
                            Scope and Overview
                        </h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Objectives</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">${strategy.objectives || 'Define clear testing objectives aligned with project goals'}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Scope</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">${strategy.scope || 'Define boundaries of testing activities'}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Approval Authority</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">Business Team, Project Management, Development Lead</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Testing Activities</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">Unit, Integration, System, Acceptance Testing</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 2: Testing Methodology -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-2">
                            <span class="w-8 h-8 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center text-green-600 dark:text-green-400">2</span>
                            Testing Methodology
                        </h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Testing Levels</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">${strategy.levels || 'Unit Testing, Integration Testing, System Testing, UAT'}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Team Roles & Responsibilities</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">QA Lead, Test Engineers, Developers, Business Analysts</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Change Management</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">Process for handling Change Requests (CR) and scope modifications</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Defect Management</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">Defect triage, re-testing, regression testing, and sign-off procedures</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 3: Test Environment -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-2">
                            <span class="w-8 h-8 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center text-purple-600 dark:text-purple-400">3</span>
                            Test Environment
                        </h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Environment Setup</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">${strategy.environments || 'Development, QA, Staging environments as required'}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Test Data Requirements</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">Data preparation, masking, and validation procedures</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Backup & Restore</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">Test data backup strategy and recovery procedures</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Environment Count</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">Minimum required environments based on project complexity</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 4: Testing Tools -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-2">
                            <span class="w-8 h-8 bg-amber-100 dark:bg-amber-900 rounded-lg flex items-center justify-center text-amber-600 dark:text-amber-400">4</span>
                            Testing Tools
                        </h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Test Management</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">${strategy.test_management_tool || 'Test case management and traceability tools'}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Automation Tools</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">${strategy.automation_tool || 'Selenium, Cypress, Playwright, or similar'}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Performance & Load</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">JMeter, LoadRunner, or similar for load testing</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Security Testing</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">OWASP ZAP, Burp Suite, or similar security tools</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 5: Release Control -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-2">
                            <span class="w-8 h-8 bg-red-100 dark:bg-red-900 rounded-lg flex items-center justify-center text-red-600 dark:text-red-400">5</span>
                            Release Control
                        </h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Release Management</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">Version-controlled release planning with history tracking</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Test Execution Strategy</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">${strategy.approach || 'Structured test execution based on release cycles'}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Regression Testing</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">Automated regression suite execution per release</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Sign-off Criteria</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">Pass rates, critical defect closure, and coverage thresholds</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 6: Risk Analysis -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-2">
                            <span class="w-8 h-8 bg-orange-100 dark:bg-orange-900 rounded-lg flex items-center justify-center text-orange-600 dark:text-orange-400">6</span>
                            Risk Analysis
                        </h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Identified Risks</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">${strategy.risks || 'Schedule constraints, resource availability, environment dependencies'}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Mitigation Strategies</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">Proactive risk monitoring and contingency planning</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Contingency Plan</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">Fallback strategies for high-impact risk scenarios</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Priority Focus</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">${strategy.priority_focus || 'Critical path testing and high-risk feature coverage'}</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 7: Review and Approvals -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-2">
                            <span class="w-8 h-8 bg-teal-100 dark:bg-teal-900 rounded-lg flex items-center justify-center text-teal-600 dark:text-teal-400">7</span>
                            Review and Approvals
                        </h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Reviewers</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">System Administration, Project Management, Development, Business Teams</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Approval Sign-off</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">Document approval with name, date, and comments</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Review Summary</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">Tracked changes and improvement recommendations</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Process Updates</p>
                                <p class="text-gray-700 dark:text-gray-300 text-sm">Continuous improvement based on review feedback</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Test Types Covered -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-100 dark:border-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">üß™ Test Types Covered</h4>
                        <div class="flex flex-wrap gap-2">
                            ${(strategy.test_types_covered || ['Functional Testing', 'Regression Testing', 'Integration Testing', 'Performance Testing', 'Security Testing', 'User Acceptance Testing']).map(type => 
                                `<span class="px-3 py-1 bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300 rounded-full text-sm">${type}</span>`
                            ).join('')}
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML = html;
        }

        // Render Test Scenarios
        function renderTestScenarios(scenarios, requirements) {
            const container = document.getElementById('testScenariosContent');
            if (!scenarios || scenarios.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No test scenarios available</p>';
                return;
            }

            const html = scenarios.map((scenario, idx) => {
                const linkedReq = requirements?.find(r => r.requirement_id === scenario.requirement_id);
                const reqText = linkedReq?.source_text || 'Original requirement';
                
                return `
                    <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700 p-5">
                        <div class="flex items-start justify-between mb-3">
                            <div>
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="px-2 py-1 bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300 rounded text-xs font-medium">${scenario.scenario_id}</span>
                                    <span class="px-2 py-1 ${scenario.priority === 'High' ? 'bg-red-100 text-red-700' : scenario.priority === 'Medium' ? 'bg-yellow-100 text-yellow-700' : 'bg-green-100 text-green-700'} rounded text-xs font-medium">${scenario.priority}</span>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-2">${scenario.description}</p>
                                <div class="text-xs text-gray-500 dark:text-gray-400">
                                    <span class="font-medium">Linked Req:</span> ${scenario.requirement_id}
                                </div>
                                <div class="mt-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded text-xs text-gray-600 dark:text-gray-300">
                                    "${reqText.substring(0, 150)}${reqText.length > 150 ? '...' : ''}"
                                </div>
                            </div>
                            <div class="text-right text-xs text-gray-500">
                                ${scenario.test_cases?.length || 0} TC(s)
                            </div>
                        </div>
                        ${scenario.preconditions?.length > 0 ? `
                            <div class="mt-3 pt-3 border-t border-gray-100 dark:border-gray-700">
                                <span class="text-xs font-medium text-gray-500 dark:text-gray-400">Preconditions:</span>
                                <span class="text-sm text-gray-600 dark:text-gray-300 ml-2">${scenario.preconditions.join(', ')}</span>
                            </div>
                        ` : ''}
                        <div class="mt-3 pt-3 border-t border-gray-100 dark:border-gray-700">
                            <span class="text-xs font-medium text-gray-500 dark:text-gray-400">Test Cases:</span>
                            <div class="flex flex-wrap gap-2 mt-1">
                                ${(scenario.test_cases || []).map(tc => 
                                    `<span class="px-2 py-1 bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 rounded text-xs cursor-pointer hover:bg-primary-100 dark:hover:bg-primary-900/50" onclick="highlightTestCase('${tc}')">${tc}</span>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
        }

        // Render Test Cases
        function renderTestCases(testCases) {
            const container = document.getElementById('testCasesList');
            
            let filteredCases = testCases;
            
            // Handle RTM stat card filters
            if (appState.rtmFilter) {
                const requirements = appState.generatedArtifacts?.normalized_requirements || [];
                const ambiguousReqIds = new Set(requirements.filter(r => r.ambiguity?.is_ambiguous).map(r => r.requirement_id));
                
                switch (appState.rtmFilter) {
                    case 'rtm-requirements':
                        // Show test cases linked to requirements (all test cases)
                        filteredCases = testCases;
                        break;
                    case 'rtm-testcases':
                        // Show all test cases
                        filteredCases = testCases;
                        break;
                    case 'rtm-coverage':
                        // Show test cases with low coverage (could be enhanced to show specific coverage)
                        filteredCases = testCases;
                        break;
                    case 'rtm-ambiguous':
                        // Show test cases linked to ambiguous requirements
                        filteredCases = testCases.filter(tc => ambiguousReqIds.has(tc.mapped_requirement_id));
                        break;
                    default:
                        filteredCases = testCases;
                }
            } else if (appState.currentFilter !== 'all') {
                filteredCases = testCases.filter(tc => 
                    tc.priority === appState.currentFilter || 
                    tc.test_type === appState.currentFilter ||
                    (appState.currentFilter === 'Manual' && !tc.automation_feasibility?.feasible) ||
                    (appState.currentFilter === 'Automation' && tc.automation_feasibility?.feasible)
                );
            }

            if (!filteredCases || filteredCases.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No test cases match the current filter</p>';
                return;
            }

            const typeColors = {
                'Positive': 'bg-green-500',
                'Negative': 'bg-red-500',
                'Edge': 'bg-purple-500',
                'Boundary': 'bg-yellow-500',
                'Security': 'bg-indigo-500',
                'API': 'bg-pink-500'
            };
            const priorityColors = {
                'P0': 'bg-red-500',
                'P1': 'bg-orange-500',
                'P2': 'bg-yellow-500',
                'P3': 'bg-green-500'
            };

            const html = filteredCases.map(tc => `
                <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700 p-4 hover:shadow-md transition-shadow" id="tc-${tc.test_case_id}">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center gap-2">
                            <span class="px-2 py-1 ${typeColors[tc.test_type] || 'bg-gray-500'} text-white rounded text-xs font-medium">${tc.test_type}</span>
                            <span class="text-xs text-gray-500">${tc.test_case_id}</span>
                            <span class="px-2 py-1 ${priorityColors[tc.priority] || 'bg-gray-500'} text-white rounded text-xs font-medium">${tc.priority}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            ${tc.automation_feasibility?.feasible ? 
                                `<span class="px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded text-xs" title="${tc.automation_feasibility?.notes}">ü§ñ Auto</span>` : 
                                `<span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded text-xs">üìù Manual</span>`
                            }
                        </div>
                    </div>
                    
                    <h4 class="text-sm font-medium text-gray-800 dark:text-gray-100 mb-2">${tc.title}</h4>
                    
                    <div class="text-xs text-gray-500 dark:text-gray-400 mb-3">
                        <span class="font-medium">Req:</span> ${tc.mapped_requirement_id}
                    </div>
                    
                    ${tc.preconditions?.length > 0 ? `
                        <div class="mb-3">
                            <span class="text-xs font-medium text-gray-500 dark:text-gray-400">Preconditions:</span>
                            <div class="flex flex-wrap gap-1 mt-1">
                                ${tc.preconditions.map(p => `<span class="px-2 py-0.5 bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-400 rounded text-xs">${p}</span>`).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="space-y-2 text-sm">
                        ${tc.steps?.map((step, i) => `
                            <div class="flex gap-2">
                                <span class="w-6 h-6 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center text-xs flex-shrink-0">${step.step_number || i + 1}</span>
                                <div class="text-gray-600 dark:text-gray-300">${step.action}</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="mt-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                        <div class="text-xs font-medium text-green-600 dark:text-green-400 mb-1">Expected Result</div>
                        <div class="text-sm text-green-700 dark:text-green-300">‚úÖ ${tc.expected_result}</div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        function highlightTestCase(tcId) {
            showPage('artifacts');
            switchArtifactTab('testcases');
            setTimeout(() => {
                const el = document.getElementById(`tc-${tcId}`);
                if (el) {
                    el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    el.classList.add('ring-2', 'ring-primary-500');
                    setTimeout(() => el.classList.remove('ring-2', 'ring-primary-500'), 2000);
                }
            }, 100);
        }

        // Render RTM
        function renderRTM(data) {
            const requirements = data.normalized_requirements || [];
            const testCases = data.test_cases || [];
            const rtm = data.test_plan?.rtm || [];
            const metrics = data.test_plan?.metrics || {};

            // Update stats
            document.getElementById('rtmReqCount').textContent = requirements.length;
            document.getElementById('rtmTcCount').textContent = testCases.length;
            document.getElementById('rtmCoverage').textContent = (metrics.coverage_percentage || 0) + '%';
            document.getElementById('rtmAmbig').textContent = requirements.filter(r => r.ambiguity?.is_ambiguous).length;

            // Render charts
            const typeDist = metrics.type_distribution || {};
            const priorityDist = metrics.priority_distribution || {};
            
            const typeColors = {
                'Positive': 'bg-green-500',
                'Negative': 'bg-red-500',
                'Edge': 'bg-purple-500',
                'Boundary': 'bg-yellow-500',
                'Security': 'bg-indigo-500',
                'API': 'bg-pink-500'
            };
            const priorityColors = {
                'P0': 'bg-red-500',
                'P1': 'bg-orange-500',
                'P2': 'bg-yellow-500',
                'P3': 'bg-green-500'
            };

            const maxType = Math.max(...Object.values(typeDist), 1);
            const maxPriority = Math.max(...Object.values(priorityDist), 1);

            document.getElementById('rtmTypeChart').innerHTML = Object.entries(typeDist).map(([type, count]) => `
                <div class="flex items-center gap-3">
                    <span class="w-20 text-xs text-gray-600 dark:text-gray-400 truncate">${type}</span>
                    <div class="flex-1 h-3 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden">
                        <div class="h-full ${typeColors[type] || 'bg-gray-500'} rounded-full transition-all" style="width: ${(count / maxType) * 100}%"></div>
                    </div>
                    <span class="w-6 text-xs font-medium text-gray-700 dark:text-gray-300">${count}</span>
                </div>
            `).join('');

            document.getElementById('rtmPriorityChart').innerHTML = Object.entries(priorityDist).map(([pri, count]) => `
                <div class="flex items-center gap-3">
                    <span class="w-8 text-xs text-gray-600 dark:text-gray-400">${pri}</span>
                    <div class="flex-1 h-3 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden">
                        <div class="h-full ${priorityColors[pri] || 'bg-gray-500'} rounded-full transition-all" style="width: ${(count / maxPriority) * 100}%"></div>
                    </div>
                    <span class="w-6 text-xs font-medium text-gray-700 dark:text-gray-300">${count}</span>
                </div>
            `).join('');

            // Render RTM table
            const tbody = document.getElementById('rtmTableBody');
            tbody.innerHTML = requirements.map(req => {
                const linkedTCs = testCases.filter(tc => tc.mapped_requirement_id === req.requirement_id);
                const badges = req.classification?.map(c => 
                    `<span class="px-1.5 py-0.5 bg-primary-100 dark:bg-primary-900 text-primary-600 dark:text-primary-400 rounded text-xs mr-1">${c}</span>`
                ).join('') || '';
                
                const priorityColors = {
                    'High': 'bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300',
                    'Medium': 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300',
                    'Low': 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300'
                };
                
                return `
                    <tr class="border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50">
                        <td class="py-3 px-4">
                            <span class="font-medium text-primary-600 dark:text-primary-400">${req.requirement_id}</span>
                        </td>
                        <td class="py-3 px-4 text-gray-600 dark:text-gray-300 max-w-xs truncate" title="${req.source_text}">
                            ${req.source_text}
                        </td>
                        <td class="py-3 px-4">${badges}</td>
                        <td class="py-3 px-4">
                            <span class="px-2 py-0.5 rounded text-xs font-medium ${priorityColors[req.priority_hint] || 'bg-gray-200 text-gray-700'}">${req.priority_hint}</span>
                        </td>
                        <td class="py-3 px-4">
                            <div class="flex flex-wrap gap-1">
                                ${linkedTCs.map(tc => 
                                    `<span class="px-2 py-0.5 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded text-xs cursor-pointer hover:bg-primary-100 dark:hover:bg-primary-900" onclick="highlightTestCase('${tc.test_case_id}')">${tc.test_case_id}</span>`
                                ).join('')}
                            </div>
                        </td>
                        <td class="py-3 px-4">
                            <span class="px-2 py-0.5 bg-primary-100 dark:bg-primary-900 text-primary-600 dark:text-primary-300 rounded text-xs">${linkedTCs.length} TC(s)</span>
                        </td>
                    </tr>
                `;
            }).join('');

            // Render RTM Heatmap
            renderRTMHeatmap(requirements, testCases);
        }

        // Toggle between Table and Heatmap views
        function toggleRTMView() {
            const tableContainer = document.getElementById('rtmTableContainer');
            const heatmap = document.getElementById('rtmBack');
            const btn = document.getElementById('rtmFlipBtn');
            
            if (tableContainer.classList.contains('hidden')) {
                tableContainer.classList.remove('hidden');
                heatmap.classList.add('hidden');
                btn.textContent = 'Show Heatmap ‚Üî';
            } else {
                tableContainer.classList.add('hidden');
                heatmap.classList.remove('hidden');
                btn.textContent = 'Show Table ‚Üî';
            }
        }

        // Filter RTM table by priority (dropdown)
        function filterRTMPriority(priority) {
            appState.rtmPriorityFilter = priority;
            
            const rows = document.querySelectorAll('#rtmTableBody tr');
            rows.forEach(row => {
                const priorityCell = row.querySelector('td:nth-child(4)');
                const rowPriority = priorityCell?.textContent.trim();
                if (priority === 'all' || rowPriority === priority) {
                    row.classList.remove('hidden');
                } else {
                    row.classList.add('hidden');
                }
            });
        }

        // Render RTM Heatmap
        function renderRTMHeatmap(requirements, testCases) {
            const heatmapContainer = document.getElementById('rtmHeatmap');
            if (!heatmapContainer) return;

            const heatmapHeader = document.getElementById('heatmapHeader');
            const heatmapBody = document.getElementById('rtmHeatmapBody');

            // Test type colors for heatmap
            const testTypeColors = {
                'Positive': 'bg-green-500',
                'Negative': 'bg-red-500',
                'Edge': 'bg-yellow-500',
                'Boundary': 'bg-blue-500',
                'Security': 'bg-indigo-500',
                'API': 'bg-pink-500'
            };

            // Get all unique test case IDs sorted
            const allTcIds = [...new Set(testCases.map(tc => tc.test_case_id))].sort((a, b) => {
                // Extract numeric part for sorting
                const numA = parseInt(a.replace(/\D/g, '')) || 0;
                const numB = parseInt(b.replace(/\D/g, '')) || 0;
                return numA - numB;
            });

            // Build header row with short TC labels (TC1, TC2, etc.)
            let headerHtml = '<th class="text-left py-2 px-2 font-medium text-gray-600 dark:text-gray-400 sticky left-0 bg-gray-50 dark:bg-gray-700/50 z-10 min-w-[60px]">Req</th>';
            allTcIds.forEach((tcId, index) => {
                headerHtml += `<th class="text-center py-2 px-1 font-medium text-gray-600 dark:text-gray-400 text-[10px] min-w-[24px]">TC${index + 1}</th>`;
            });
            heatmapHeader.innerHTML = headerHtml;

            // Build body rows with requirements
            let bodyHtml = '';
            requirements.forEach(req => {
                const reqTCs = testCases.filter(tc => tc.mapped_requirement_id === req.requirement_id);
                const reqTCMap = new Map(reqTCs.map(tc => [tc.test_case_id, tc]));

                let rowHtml = `<tr class="border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50">`;
                rowHtml += `<td class="py-1 px-2 font-medium text-primary-600 dark:text-primary-400 sticky left-0 bg-white dark:bg-gray-800 z-10 text-xs">${req.requirement_id}</td>`;

                allTcIds.forEach((tcId, index) => {
                    const tc = reqTCMap.get(tcId);
                    if (tc) {
                        const colorClass = testTypeColors[tc.test_type] || 'bg-gray-500';
                        // Show actual TC ID on hover with data attribute and title
                        rowHtml += `<td class="py-1 px-0.5 text-center">
                            <span class="inline-block w-4 h-4 rounded-sm ${colorClass} cursor-pointer hover:opacity-80 transition-opacity group relative" 
                                  data-tc-id="${tc.test_case_id}" 
                                  onclick="highlightTestCase('${tc.test_case_id}')">
                                <!-- Tooltip on hover -->
                                <span class="absolute bottom-full left-1/2 -translate-x-1/2 mb-1 px-2 py-1 bg-gray-900 dark:bg-gray-700 text-white text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-20">${tc.test_case_id}</span>
                            </span>
                        </td>`;
                    } else {
                        rowHtml += `<td class="py-1 px-0.5 text-center">
                            <span class="inline-block w-4 h-4 rounded-sm bg-gray-100 dark:bg-gray-700"></span>
                        </td>`;
                    }
                });

                rowHtml += `</tr>`;
                bodyHtml += rowHtml;
            });

            heatmapBody.innerHTML = bodyHtml;
        }

        // Export Artifacts
        function exportArtifacts() {
            if (!appState.generatedArtifacts) {
                showToast('No artifacts to export', 'warning');
                return;
            }
            
            const data = JSON.stringify(appState.generatedArtifacts, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `test-artifacts-${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Artifacts exported!', 'success');
        }

        // Download Document (Test Plan/Test Strategy in MD/DOC/PDF)
        function downloadDocument(type, format) {
            if (!appState.generatedArtifacts) {
                showToast('No artifacts to download', 'warning');
                return;
            }
            
            let content = '';
            let filename = '';
            const date = new Date().toLocaleDateString();
            
            if (type === 'testplan') {
                const tp = appState.generatedArtifacts;
                content = generateTestPlanMD(tp);
                filename = `test-plan-${new Date().toISOString().slice(0,10)}`;
            } else {
                const ts = appState.generatedArtifacts.test_plan?.test_strategy || {};
                content = generateTestStrategyMD(ts);
                filename = `test-strategy-${new Date().toISOString().slice(0,10)}`;
            }
            
            if (format === 'md') {
                downloadFile(content, `${filename}.md`, 'text/markdown');
                showToast(`${type === 'testplan' ? 'Test Plan' : 'Test Strategy'} downloaded as MD`, 'success');
            } else if (format === 'doc') {
                // Convert MD to HTML for DOC download
                const htmlContent = mdToHtml(content);
                downloadFile(htmlContent, `${filename}.html`, 'text/html');
                showToast(`${type === 'testplan' ? 'Test Plan' : 'Test Strategy'} downloaded as HTML (DOC)`, 'success');
            } else if (format === 'pdf') {
                // For PDF, we'll use print functionality
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <html>
                    <head>
                        <title>${type === 'testplan' ? 'Test Plan' : 'Test Strategy'}</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }
                            h1 { color: #333; border-bottom: 2px solid #6366f1; padding-bottom: 10px; }
                            h2 { color: #555; margin-top: 30px; }
                            h3 { color: #666; }
                            p, li { color: #444; line-height: 1.6; }
                            .signature-block { margin-top: 50px; border-top: 1px solid #ccc; padding-top: 20px; }
                            .signature-line { display: flex; justify-content: space-between; margin-top: 30px; }
                            .signature-field { width: 30%; }
                            .signature-field span { display: block; border-bottom: 1px solid #333; margin-top: 40px; font-size: 12px; }
                            @media print { body { padding: 20px; } }
                        </style>
                    </head>
                    <body>${mdToHtml(content)}</body>
                    </html>
                `);
                printWindow.document.close();
                setTimeout(() => {
                    printWindow.print();
                }, 500);
                showToast(`${type === 'testplan' ? 'Test Plan' : 'Test Strategy'} PDF opened for printing`, 'success');
            }
        }
        
        function generateTestPlanMD(tp) {
            return `# TEST PLAN

**Plan ID:** ${tp.plan_id}  
**Version:** ${tp.version}  
**Date:** ${new Date().toLocaleDateString()}  
**Status:** Draft

---

## 1.0 INTRODUCTION

This document provides a comprehensive summary of the product being tested and outlines all functions at a high level. The test plan defines the scope, objectives, approach, and resources required for successful testing of the system.

## 2.0 OBJECTIVES AND TASKS

### 2.1 Objectives

${tp.objectives || 'Define testing objectives, tasks, responsibilities, and establish communication channels. This plan serves as a vehicle for coordination between testing team and stakeholders.'}

### 2.2 Tasks

- Test Case Design and Development
- Test Execution
- Defect Reporting and Tracking
- Test Summary and Reporting
- Post-testing Activities

## 3.0 SCOPE

### General

${tp.scope || 'Testing covers new functions, existing interfaces, and integration of all components as defined in the requirements specification.'}

### Tactics

Testing will follow a risk-based approach prioritizing critical functionality. Key stakeholders will be notified and scheduled to assist in testing activities.

## 4.0 TESTING STRATEGY

### 4.1 Unit Testing

Individual components tested in isolation. Minimum 80% code coverage required. Developers responsible for unit testing.

### 4.2 System and Integration Testing

Full system testing and integration testing to verify component interactions. QA team conducts these tests.

### 4.3 Performance and Stress Testing

Load testing, stress testing, and performance benchmarking under expected and peak conditions.

### 4.4 User Acceptance Testing

End-users validate system against business requirements. Sign-off required before production release.

### 4.5 Batch Testing

Automated batch jobs and scheduled processes validation.

### 4.6 Automated Regression Testing

Automated test suites executed to verify no unintended effects from changes. Critical for continuous delivery.

### 4.7 Beta Testing

Limited release to external users for real-world feedback before general availability.

## 5.0 HARDWARE REQUIREMENTS

- **Computers:** Development workstations, QA testing environments, and build servers as per project specifications.
- **Modems/Network:** Network connectivity for distributed testing and integration testing requirements.

## 6.0 ENVIRONMENT REQUIREMENTS

### 6.1 Main Frame

Production-like environment with necessary hardware, communications, and system software. Security level as per enterprise standards.

### 6.2 Workstation

End-user workstations matching production configuration for UAT and compatibility testing.

## 7.0 TEST SCHEDULE

Timeline aligned with project milestones. Each testing phase (Unit, Integration, System, UAT) scheduled with estimated effort. Resources allocated per testing task.

## 8.0 CONTROL PROCEDURES

### Problem Reporting

Standard incident logging procedure. Defects tracked with severity, priority, and status. Resolution timeline based on severity levels.

### Change Requests

Change management process with sign-off criteria. Impact analysis for affected modules. Regression testing required for changes.

## 9.0 FEATURES TO BE TESTED

${tp.metrics?.total_requirements || 0} requirements identified for testing. Coverage includes all functional requirements, integration points, and critical business workflows.

## 10.0 FEATURES NOT TO BE TESTED

Third-party components tested by vendors, previously tested stable features (with regression coverage only), and non-functional aspects covered under separate test plans.

## 11.0 RESOURCES/ROLES & RESPONSIBILITIES

| Role | Responsibility |
|------|---------------|
| QA Lead | Overall test coordination and management |
| Test Engineers | Test case design and execution |
| Developers | Unit testing and defect fixes |
| Business Analysts | Requirements clarification and UAT support |

## 12.0 SCHEDULES

**Major Deliverables:**
- Test Plan Document
- Test Cases Document
- Test Incident Reports
- Test Summary Reports

## 13.0 SIGNIFICANTLY IMPACTED DEPARTMENTS (SIDs)

| Department/Business Area | Bus. Manager | Tester(s) |
|-------------------------|--------------|-----------|
| QA Team | [ENTER NAME] | [ENTER NAME] |
| Development | [ENTER NAME] | [ENTER NAME] |
| Business/Operations | [ENTER NAME] | [ENTER NAME] |

## 14.0 DEPENDENCIES

Test item availability, testing-resource availability, environment readiness, and stakeholder availability for UAT. Dependencies on third-party systems for integration testing.

## 15.0 RISKS/ASSUMPTIONS

High-risk assumptions identified. Contingency plans for delays in test item delivery (increased night shift), resource constraints (cross-training), and environment issues (fallback environments).

## 16.0 TOOLS

- **Automation Tools:** Selenium, Cypress, or similar
- **Bug Tracking:** Jira, Bugzilla, or similar
- **Test Management:** TestRail, Zephyr, or similar
- **Performance Testing:** JMeter, LoadRunner, or similar

## 17.0 APPROVALS

| Name (In Capital Letters) | Signature | Date |
|--------------------------|-----------|------|
| [ENTER NAME] | _______________________ | __________ |
| [ENTER NAME] | _______________________ | __________ |
| [ENTER NAME] | _______________________ | __________ |
| [ENTER NAME] | _______________________ | __________ |

---

*Document generated by AI Test Case Generator*
`;
        }
        
        function generateTestStrategyMD(strategy) {
            return `# TEST STRATEGY DOCUMENT

**Date:** ${new Date().toLocaleDateString()}  
**Version:** 1.0

---

## 1. SCOPE AND OVERVIEW

### Objectives

${strategy.objectives || 'Define clear testing objectives aligned with project goals'}

### Scope

${strategy.scope || 'Define boundaries of testing activities'}

### Approval Authority

Business Team, Project Management, Development Lead

### Testing Activities

Unit Testing, Integration Testing, System Testing, Acceptance Testing

## 2. TESTING METHODOLOGY

### Testing Levels

${strategy.levels || 'Unit Testing, Integration Testing, System Testing, UAT'}

### Team Roles & Responsibilities

QA Lead, Test Engineers, Developers, Business Analysts

### Change Management

Process for handling Change Requests (CR) and scope modifications

### Defect Management

Defect triage, re-testing, regression testing, and sign-off procedures

## 3. TEST ENVIRONMENT

### Environment Setup

${strategy.environments || 'Development, QA, Staging environments as required'}

### Test Data Requirements

Data preparation, masking, and validation procedures

### Backup & Restore

Test data backup strategy and recovery procedures

### Environment Count

Minimum required environments based on project complexity

## 4. TESTING TOOLS

### Test Management

${strategy.test_management_tool || 'Test case management and traceability tools'}

### Automation Tools

${strategy.automation_tool || 'Selenium, Cypress, Playwright, or similar'}

### Performance & Load

${strategy.performance_tool || 'JMeter, LoadRunner, or similar for load testing'}

### Security Testing

${strategy.security_tool || 'OWASP ZAP, Burp Suite, or similar security tools'}

## 5. RELEASE CONTROL

### Release Management

Version-controlled release planning with history tracking

### Test Execution Strategy

${strategy.approach || 'Structured test execution based on release cycles'}

### Regression Testing

Automated regression suite execution per release

### Sign-off Criteria

Pass rates, critical defect closure, and coverage thresholds

## 6. RISK ANALYSIS

### Identified Risks

${strategy.risks || 'Schedule constraints, resource availability, environment dependencies'}

### Mitigation Strategies

Proactive risk monitoring and contingency planning

### Contingency Plan

Fallback strategies for high-impact risk scenarios

### Priority Focus

${strategy.priority_focus || 'Critical path testing and high-risk feature coverage'}

## 7. REVIEW AND APPROVALS

### Reviewers

System Administration, Project Management, Development, Business Teams

### Approval Sign-off

Document approval with name, date, and comments

### Review Summary

Tracked changes and improvement recommendations

### Process Updates

Continuous improvement based on review feedback

---

*Document generated by AI Test Case Generator*
`;
        }
        
        function mdToHtml(md) {
            return md
                .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                .replace(/^#### (.*$)/gm, '<h4>$1</h4>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/^\- (.*$)/gm, '<li>$1</li>')
                .replace(/^\| (.*) \|$/gm, (match, content) => {
                    const cells = content.split(' | ').map(c => `<td>${c.trim()}</td>`).join('');
                    return `<tr>${cells}</tr>`;
                })
                .replace(/^\|---/gm, '')
                .replace(/^\s*\n/gm, '</p><p>')
                .replace(/^([^<\n]+)$/gm, '<p>$1</p>')
                .replace(/<p><\/p>/g, '')
                .replace(/<h1>/g, '<h1 style="color: #333; border-bottom: 2px solid #6366f1; padding-bottom: 10px;">')
                .replace(/<h2>/g, '<h2 style="color: #555; margin-top: 25px;">')
                .replace(/---\n/g, '<hr style="border: none; border-top: 1px solid #ddd; margin: 20px 0;">')
                .replace(/`([^`]+)`/g, '<code style="background: #f4f4f4; padding: 2px 6px; border-radius: 3px;">$1</code>');
        }
        
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initialize
        updateCharCount();
    </script>
</body>
</html>
